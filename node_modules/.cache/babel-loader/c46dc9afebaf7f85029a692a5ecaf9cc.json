{"remainingRequest":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\babel-loader\\lib\\index.js!D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DownLoad\\git\\achieve\\AchieveIt-web\\src\\components\\base\\upload-imgs\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\src\\components\\base\\upload-imgs\\index.vue","mtime":1584099524203},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"D:\\\\DownLoad\\\\git\\\\achieve\\\\AchieveIt-web\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getFileType, checkIsAnimated, isEmptyObj, createId } from './utils';\n/**\r\n * 本地图像通过验证后构造的信息对象\r\n * @typedef {Object<string, number, any>} LocalFileInfo\r\n * @property {string} localSrc 本地图像预览地址\r\n * @property {File} file 本地图像文件\r\n * @property {number} width 宽\r\n * @property {number} height 高\r\n * @property {string} name 文件名\r\n * @property {number} size 文件大小\r\n * @property {string} type 文件的媒体类型 (MIME)\r\n * @property {Date} lastModified 文件最后修改时间\r\n * @property {boolean} isAnimated 是否是动态图, 如果不进行检测则为 null\r\n */\n\n/**\r\n * 返回数据对象\r\n * 初始化的图片如果没有传入字段, 则值为空 null\r\n * @typedef {Object<string, number>} ReturnItem\r\n * @property {number|string} id 初始化数据的 id\r\n * @property {number|string} imgId 图像资源 id\r\n * @property {string} src 文件相对路径\r\n * @property {string} display 图像完整地址\r\n * @property {number} height 高\r\n * @property {number} width 宽\r\n * @property {string} fileName 文件名\r\n * @property {string} fileType 文件的媒体类型 (MIME), 针对部分文件类型做了检测\r\n * @property {boolean} isAnimated 是否是动态图, 如果不进行检测则为 null\r\n */\n\n/**\r\n * 返回数据对象\r\n * @typedef {Object} ValidateRule\r\n * @property {array|number} ratio 比例 [宽，高], 或者 宽/高 的数值\r\n * @property {number} width 宽度必需等于\r\n * @property {number} height 高度必需等于\r\n * @property {number} minWidth 最小宽\r\n * @property {number} minHeight 最小高\r\n * @property {number} minSize 最小 size（Mb)\r\n * @property {number} maxSize 最大 size（Mb)\r\n * @property {number} allowAnimated 是否允许上传动图, 0 不检测, 1 不允许动图, 2 只允许动图. 要检查此项, 需设置属性 animated-check 为 true\r\n */\n\nvar ONE_KB = 1024;\nvar ONE_MB = ONE_KB * 1024;\n/**\r\n * 创建项, 如不传入参数则创建空项\r\n * status 状态转换说明:\r\n *  - 如果不传入参数, 创建上传空项, status: input\r\n *  - 如果只传入 data, 不传入 oldData\r\n *    - data 是本地数据(数据中是否携带id), status: new\r\n *    - data 不是本地数据(来源可能是初始化或是其他), status 与原状态保持一致, 如果没有原状态就是 init\r\n *  - data 与 oldData 都传入\r\n *    - data 为本地数据, oldData 是 input/new, status: new\r\n *    - data 为本地数据, oldData 是 init/edit, status: edit\r\n *    - data 不是本地数据, status 与原状态保持一致, 如果没有原状态就是 init\r\n * @returns {Item}\r\n */\n\nfunction createItem() {\n  var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n  var oldData = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var item = {\n    loading: false,\n    id: createId(),\n    status: 'input',\n    // new/edit/del/init/input\n    src: '',\n    // 图像相对地址\n    display: '',\n    // 图像完整地址, 用于显示\n    imgId: '' // 图像资源 id\n    // 未传入data, 说明是单纯新建, 单纯新建的值是输入框状态\n\n  };\n\n  if (!data) {\n    return item;\n  } // 判断是否是本地图片\n\n\n  if (data.file && !data.id) {\n    if (!isEmptyObj(oldData)) {\n      // 如果旧数据状态是输入框, 则为新图片\n      if (oldData.status === 'input' || oldData.status === 'new') {\n        item.status = 'new';\n      } // 如果旧数据状态是初始化 init, 则为修改\n\n\n      if (oldData.status === 'init' || oldData.status === 'edit') {\n        item.status = 'edit';\n      }\n    } else {\n      item.status = 'new';\n    } // 本地数据初始化\n\n\n    item.id = oldData.id || item.id;\n    item.src = '';\n    item.imgId = '';\n    item.display = data.localSrc || item.display;\n    item = Object.assign({}, data, item);\n    return item;\n  } // 存在id, 说明是传入已存在数据\n\n\n  item.id = data.id;\n  item.imgId = data.imgId || item.imgId;\n  item.src = data.src || item.src;\n  item.display = data.display || item.display;\n  item.status = data.status || 'init';\n  item = Object.assign({}, data, item);\n  return item;\n}\n/**\r\n * 获取范围类型限制的提示文本\r\n * @param {String} prx 提示前缀\r\n * @param {Number} min 范围下限\r\n * @param {Number} max 范围上限\r\n * @param {String} unit 单位\r\n */\n\n\nfunction getRangeTip(prx, min, max) {\n  var unit = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '';\n  var str = prx;\n\n  if (min && max) {\n    // 有范围限制\n    str += \" \".concat(min).concat(unit, \"~\").concat(max).concat(unit);\n  } else if (min) {\n    // 只有最小范围\n    str += \" \\u2265 \".concat(min).concat(unit);\n  } else if (max) {\n    // 只有最大范围\n    str += \" \\u2264 \".concat(max).concat(unit);\n  } else {\n    // 无限制\n    str += '无限制';\n  }\n\n  return str;\n}\n/** for originUpload: 一次请求最多的文件数量 */\n\n\nvar uploadLimit = 10;\n/** for originUpload: 文件对象缓存 */\n\nvar catchData = [];\n/** for originUpload: 计时器缓存 */\n\nvar time;\nexport default {\n  name: 'UploadImgs',\n  data: function data() {\n    return {\n      itemList: [],\n      loading: false,\n      currentId: '',\n      // 正在操作项的id\n      globalImgPriview: '$imagePreview' // 全局图片预览方法名\n\n    };\n  },\n  props: {\n    /** 每一项宽度 */\n    width: {\n      type: [Number, String],\n      default: 160\n    },\n\n    /** 每一项高度 */\n    height: {\n      type: [Number, String],\n      default: 160\n    },\n\n    /** 是否开启自动上传 */\n    autoUpload: {\n      type: Boolean,\n      default: true\n    },\n\n    /** 初始化数据 */\n    value: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n\n    /** 接受的文件类型 */\n    accept: {\n      type: String,\n      default: 'image/*'\n    },\n\n    /** 最少图片数量 */\n    minNum: {\n      type: Number,\n      default: 0\n    },\n\n    /** 最多图片数量, 0 表示无限制 */\n    maxNum: {\n      type: Number,\n      default: 0\n    },\n\n    /** 是否可排序 */\n    sortable: {\n      type: Boolean,\n      default: false\n    },\n\n    /** 是否可预览 */\n    preview: {\n      type: Boolean,\n      default: true\n    },\n\n    /** 是否可以一次多选 */\n    multiple: {\n      type: Boolean,\n      default: false\n    },\n\n    /** 图像验证规则 */\n    rules: {\n      type: [Object, Function],\n      default: function _default() {\n        return {\n          maxSize: 2\n        };\n      }\n    },\n\n    /** 是否禁用, 禁用后只可展示 不可进行编辑操作, 包括: 新增, 修改, 删除, 改变顺序 */\n    disabled: {\n      type: Boolean,\n      default: false\n    },\n\n    /** 上传前插入方法, 属于高级用法 */\n    beforeUpload: {\n      type: Function,\n      default: null\n    },\n\n    /** 重写上传方法, 如果重写则覆盖组件内上传方法 */\n    remoteFuc: {\n      type: Function,\n      default: null\n    },\n\n    /** 图像显示模式 */\n    fit: {\n      type: String,\n      default: 'contain'\n    },\n\n    /** 检测是否是动图 */\n    animatedCheck: {\n      type: Boolean,\n      default: false\n    }\n  },\n  computed: {\n    /** 每项容器样式 */\n    boxStyle: function boxStyle() {\n      var width = this.width,\n          height = this.height,\n          disabled = this.disabled;\n      var style = {};\n\n      if (typeof width === 'number') {\n        style.width = \"\".concat(width, \"px\");\n      } else if (typeof width === 'string') {\n        style.width = width;\n      }\n\n      if (typeof height === 'number') {\n        style.height = \"\".concat(height, \"px\");\n      } else if (typeof height === 'string') {\n        style.height = height;\n      }\n\n      if (disabled) {\n        style.cursor = 'not-allowed';\n      } else {\n        style.cursor = 'pointer';\n      }\n      /** 提示字体最大尺寸 */\n\n\n      var fontSize = 12;\n      /** 每行提示预设 */\n\n      var maxText = 8;\n\n      if (typeof width === 'number' && width / maxText < fontSize) {\n        fontSize = (width / maxText).toFixed(2);\n      }\n\n      style.fontSize = \"\".concat(fontSize, \"px\");\n      style.textAlign = 'center';\n      style.position = 'relative';\n      style.display = 'flex';\n      style.alignItems = 'center';\n      style.justifyContent = 'center';\n      style.overflow = 'hidden';\n      style.lineHeight = '1.3';\n      style.flexDirection = 'column';\n      return style;\n    },\n\n    /**\r\n     * 上传图像数量下限\r\n     * @returns {Number}\r\n     */\n    min: function min() {\n      var minNum = this.minNum;\n      return minNum < 0 ? 0 : parseInt(minNum, 10);\n    },\n\n    /**\r\n     * 上传图像数量上限\r\n     * @returns {Number}\r\n     */\n    max: function max() {\n      var min = this.min,\n          maxNum = this.maxNum; // 兼容用最大值小于最小值情况\n\n      return maxNum < min ? min : parseInt(maxNum, 10);\n    },\n\n    /**\r\n     * 是否是固定数量(最小等于最大)\r\n     * @returns {Boolean}\r\n     */\n    isStable: function isStable() {\n      var min = this.min,\n          max = this.max;\n      return max !== 0 && min === max;\n    },\n\n    /** 构造图像规范提示 */\n    rulesTip: function rulesTip() {\n      var rules = this.rules;\n      var tips = [];\n      /** 图像验证规则 */\n\n      var basicRule; // 针对动态规则模式, 获取输入为空时的规则\n      // 动态规则 rule 为函数, 当选择图片后根据选择的图片生成校验规则\n\n      if (typeof rules === 'function') {\n        try {\n          basicRule = rules();\n        } catch (err) {\n          basicRule = {};\n        }\n      } else {\n        basicRule = rules || {};\n      } // 宽高限制提示语\n\n\n      if (basicRule.width && basicRule.height) {\n        // 固定宽高限制\n        tips.push(\"\\u5BBD\\u9AD8 \".concat(basicRule.width, \"x\").concat(basicRule.height));\n      } else if (basicRule.width) {\n        // 固定宽限制\n        tips.push(\"\\u5BBD\\u5EA6 \".concat(basicRule.width));\n        tips.push(\"\".concat(getRangeTip('高度', basicRule.minHeight, basicRule.maxHeight)));\n      } else if (basicRule.height) {\n        // 固定高限制\n        tips.push(\"\\u9AD8\\u5EA6 \".concat(basicRule.height));\n        tips.push(\"\".concat(getRangeTip('宽度', basicRule.minWidth, basicRule.maxWidth)));\n      } else {\n        // 宽高都不固定\n        tips.push(\"\".concat(getRangeTip('宽度', basicRule.minWidth, basicRule.maxWidth)));\n        tips.push(\"\".concat(getRangeTip('高度', basicRule.minHeight, basicRule.maxHeight)));\n      } // 宽高比限制提示语\n\n\n      if (basicRule.ratio) {\n        if (Array.isArray(basicRule.ratio)) {\n          tips.push(\"\\u5BBD\\u9AD8\\u6BD4 \".concat(basicRule.ratio.join(':')));\n        } else {\n          tips.push(\"\\u5BBD\\u9AD8\\u6BD4 \".concat(basicRule.ratio));\n        }\n      } // 文件大小\n\n\n      if (basicRule.minSize || basicRule.maxSize) {\n        tips.push(getRangeTip('文件大小', basicRule.minSize, basicRule.maxSize, 'Mb'));\n      } // 是否动态图\n\n\n      if (basicRule.allowAnimated && basicRule.allowAnimated > 0) {\n        if (basicRule.allowAnimated === 1) {\n          tips.push('不允许上传动图');\n        } else if (basicRule.allowAnimated === 1) {\n          tips.push('只允许上传动图');\n        }\n      }\n\n      return tips;\n    }\n  },\n  watch: {\n    /** 初始化值修改时重新初始化, 并且清空当前的编辑状态 */\n    value: function value(val) {\n      // 初始化数据\n      this.initItemList(val);\n    }\n  },\n  mounted: function mounted() {\n    this.initItemList(this.value);\n  },\n  methods: {\n    /**\r\n     * 上传缓存中的图片\r\n     * @param {Array} uploadList 需要上传的缓存集合, 集合中包含回调函数\r\n     */\n    uploadCatch: function uploadCatch(uploadList) {\n      var _this = this;\n\n      var data = {};\n      uploadList.forEach(function (item, index) {\n        data[\"file_\".concat(index)] = item.img.file;\n      });\n      return this.$axios({\n        method: 'post',\n        url: '/cms/file',\n        data: data\n      }).then(function (res) {\n        if (!Array.isArray(res) || res.length === 0) {\n          throw new Error('图像上传失败');\n        }\n\n        var resObj = res.reduce(function (acc, item) {\n          acc[item.key] = item;\n          return acc;\n        }, {});\n        uploadList.forEach(function (item, index) {\n          var remoteData = resObj[\"file_\".concat(index)];\n          item.cb(remoteData);\n        });\n      }).catch(function (err) {\n        uploadList.forEach(function (item) {\n          item.cb(false);\n        });\n        var msg = '图像上传失败, 请重试';\n\n        if (err.message) {\n          // eslint-disable-next-line\n          msg = err.message;\n        }\n\n        console.error(err);\n\n        _this.$message.error(msg);\n      });\n    },\n\n    /**\r\n     * 内置上传文件方法, 使用 debounce 优化提交效率\r\n     * 此处只能使用回调模式, 因为涉及 debounce 处理, promise 不可在外部改变其状态\r\n     * @param {Object} img 需要上传的数据项\r\n     * @param {Function} cb 回调函数\r\n     */\n    originUpload: function originUpload(img, cb) {\n      var _this2 = this;\n\n      // 并且一次最多上传文件数量设为可配置\n      // 添加缓存\n      catchData.push({\n        img: img,\n        cb: cb\n      }); // 等于上限, 立即上传\n\n      if (catchData.length === uploadLimit) {\n        var data = _toConsumableArray(catchData);\n\n        catchData = [];\n        clearTimeout(time);\n        time = null;\n        return this.uploadCatch(data);\n      } // 清除上次一的定时器\n\n\n      if (time && catchData.length < uploadLimit) {\n        clearTimeout(time); // 此时修改上一个 promise 状态为reslove\n      } // 等待100ms\n\n\n      time = setTimeout(function () {\n        _this2.uploadCatch(_toConsumableArray(catchData));\n\n        catchData = [];\n        time = null;\n      }, 50);\n    },\n\n    /**\r\n     * 上传图像文件\r\n     * @param {Object} 需要上传的项, 包含文化和其它信息\r\n     */\n    uploadImg: function () {\n      var _uploadImg = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(item) {\n        var _this3 = this;\n\n        var reduceResult, result, _result;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                // 远程结果处理\n                reduceResult = function reduceResult(imgItem, res) {\n                  // eslint-disable-next-line\n                  imgItem.loading = false;\n\n                  if (!res) {\n                    return;\n                  } // eslint-disable-next-line\n\n\n                  imgItem.display = res.url; // eslint-disable-next-line\n\n                  imgItem.src = res.path; // eslint-disable-next-line\n\n                  imgItem.imgId = res.id; // eslint-disable-next-line\n\n                  imgItem.file = null;\n                  window.URL.revokeObjectURL(imgItem.display);\n                };\n\n                if (!(item.status === 'input' || !item.file)) {\n                  _context.next = 3;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 3:\n                // eslint-disable-next-line\n                item.loading = true;\n\n                if (!(this.beforeUpload && typeof this.beforeUpload === 'function')) {\n                  _context.next = 12;\n                  break;\n                }\n\n                if (!(typeof this.beforeUpload === 'function')) {\n                  _context.next = 12;\n                  break;\n                }\n\n                _context.next = 8;\n                return new Promise(function (resolve) {\n                  var beforeUploadResult;\n\n                  try {\n                    beforeUploadResult = _this3.beforeUpload(item, function (data) {\n                      resolve(!!data);\n                    });\n                  } catch (err) {\n                    resolve(false);\n                  } // promise 模式\n\n\n                  if (beforeUploadResult != null && typeof beforeUploadResult.then === 'function') {\n                    beforeUploadResult.then(function (remoteData) {\n                      resolve(!!remoteData);\n                    }).catch(function () {\n                      resolve(false);\n                    });\n                  }\n                });\n\n              case 8:\n                result = _context.sent;\n\n                if (result) {\n                  _context.next = 12;\n                  break;\n                }\n\n                reduceResult(item, false);\n                return _context.abrupt(\"return\", false);\n\n              case 12:\n                if (!(this.remoteFuc && typeof this.remoteFuc === 'function')) {\n                  _context.next = 20;\n                  break;\n                }\n\n                _context.next = 15;\n                return new Promise(function (resolve) {\n                  var remoteFucResult;\n\n                  try {\n                    remoteFucResult = _this3.remoteFuc(item.file, function (remoteData) {\n                      resolve(remoteData || false);\n                    });\n                  } catch (err) {\n                    _this3.$message.error('执行自定义上传出错');\n\n                    resolve(false);\n                  } // promise 模式\n\n\n                  if (remoteFucResult != null && typeof remoteFucResult.then === 'function') {\n                    remoteFucResult.then(function (remoteData) {\n                      resolve(remoteData || false);\n                    }).catch(function () {\n                      resolve(false);\n                    });\n                  }\n                });\n\n              case 15:\n                _result = _context.sent;\n                reduceResult(item, _result);\n\n                if (_result) {\n                  _context.next = 19;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", false);\n\n              case 19:\n                return _context.abrupt(\"return\", item);\n\n              case 20:\n                return _context.abrupt(\"return\", new Promise(function (resolve) {\n                  _this3.originUpload(item, function (data) {\n                    reduceResult(item, data);\n\n                    if (!data) {\n                      resolve(false);\n                    } else {\n                      resolve(item);\n                    }\n                  });\n                }));\n\n              case 21:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function uploadImg(_x) {\n        return _uploadImg.apply(this, arguments);\n      }\n\n      return uploadImg;\n    }(),\n\n    /**\r\n     * 获取当前组件数据\r\n     */\n    getValue: function () {\n      var _getValue = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var itemList, isStable, min, l, i, asyncList, _i, imgInfoList, result;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                itemList = this.itemList, isStable = this.isStable, min = this.min; // 检查是否有不符合要求的空项\n\n                l = isStable ? itemList.length : itemList.length - 1;\n                i = 0;\n\n              case 3:\n                if (!(i < l)) {\n                  _context2.next = 10;\n                  break;\n                }\n\n                if (!(itemList[i].status === 'input')) {\n                  _context2.next = 7;\n                  break;\n                }\n\n                this.$message.error('当前存在未选择图片, 请全部选择');\n                return _context2.abrupt(\"return\", false);\n\n              case 7:\n                i += 1;\n                _context2.next = 3;\n                break;\n\n              case 10:\n                if (!(l < min)) {\n                  _context2.next = 13;\n                  break;\n                }\n\n                this.$message.error(\"\\u81F3\\u5C11\\u9009\\u62E9\".concat(min, \"\\u5F20\\u56FE\\u7247\"));\n                return _context2.abrupt(\"return\", false);\n\n              case 13:\n                // 提取需要上传文件\n                asyncList = [];\n\n                for (_i = 0; _i < itemList.length; _i += 1) {\n                  // 跳过上传组件\n                  if (itemList[_i].status !== 'input') {\n                    if (!itemList[_i].file) {\n                      asyncList.push(Promise.resolve(itemList[_i]));\n                    } else {\n                      // 上传文件后获取对应key值\n                      asyncList.push(this.uploadImg(itemList[_i]));\n                    }\n                  }\n                }\n\n                _context2.next = 17;\n                return Promise.all(asyncList);\n\n              case 17:\n                imgInfoList = _context2.sent;\n\n                if (!imgInfoList.some(function (item) {\n                  return !item;\n                })) {\n                  _context2.next = 20;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", false);\n\n              case 20:\n                // 如无错误, 表示图像都以上传, 开始构造数据\n\n                /**\r\n                 * @type {array<ReturnItem>}\r\n                 */\n                result = imgInfoList.map(function (item) {\n                  /** @type {ReturnItem} */\n                  var val = {\n                    id: item.status === 'new' ? '' : item.id,\n                    imgId: item.imgId || null,\n                    src: item.src || null,\n                    display: item.display,\n                    width: item.width || null,\n                    height: item.height || null,\n                    fileSize: item.size || null,\n                    fileName: item.name || null,\n                    fileType: item.type || null,\n                    isAnimated: item.isAnimated || null\n                  };\n                  return val;\n                }); // 获取数据成功后发出\n\n                this.$emit('upload', result);\n                return _context2.abrupt(\"return\", result);\n\n              case 23:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getValue() {\n        return _getValue.apply(this, arguments);\n      }\n\n      return getValue;\n    }(),\n\n    /**\r\n     * 删除某项\r\n     * @param {Number|String} id 删除项 id\r\n     */\n    delItem: function delItem(id) {\n      var itemList = this.itemList,\n          isStable = this.isStable; // 根据id找到对应项\n\n      var index = itemList.findIndex(function (item) {\n        return item.id === id;\n      });\n      var blobUrl = itemList[index].display;\n\n      if (isStable) {\n        // 固定数量图片, 删除后留下空项\n        itemList[index] = createItem();\n        this.itemList = _toConsumableArray(itemList);\n      } else {\n        itemList.splice(index, 1);\n      } // 释放内存\n\n\n      window.URL.revokeObjectURL(blobUrl);\n      this.initItemList(this.itemList);\n    },\n\n    /**\r\n     * 预览图像\r\n     * @param {Object} data 需要预览的项的数据\r\n     * @param {Number} index 索引序号\r\n     */\n    previewImg: function previewImg(data, index) {\n      // 如果有全局预览方法\n      if (this[this.globalImgPriview]) {\n        var images = [];\n        this.itemList.forEach(function (element) {\n          if (element.display) {\n            images.push(element.display);\n          }\n        });\n        this[this.globalImgPriview]({\n          images: images,\n          index: index\n        });\n      } else {\n        // element 原生粗糙模式\n        this.$confirm(\"<img src=\\\"\".concat(data.display, \"\\\" style=\\\"width: 100%;\\\" />\"), '预览', {\n          dangerouslyUseHTMLString: true\n        });\n      }\n    },\n\n    /**\r\n     * 移动图像位置\r\n     * @param {Number|String} id 操作项的 id\r\n     * @param {Number} step 移动的偏移量\r\n     */\n    move: function move(id, step) {\n      var itemList = this.itemList,\n          isStable = this.isStable; // 找到操作的元素\n\n      var index = itemList.findIndex(function (item) {\n        return item.id === id;\n      }); // 边界检测\n\n      if (index + step < 0 || index + step >= itemList.length) return; // 非固定项时, 不可和最后一项输入换位子\n\n      if (!isStable && index + step === itemList.length - 1) {\n        if (itemList[itemList.length - 1].status === 'input') return;\n      }\n\n      var i = itemList[index];\n      var j = itemList[index + step];\n      itemList[index] = j;\n      itemList[index + step] = i;\n      this.itemList = _toConsumableArray(itemList);\n    },\n\n    /**\r\n     * 验证上传的图像是否符合要求\r\n     * @param {LocalFileInfo} imgInfo 图像信息, 包括文件名, 宽高\r\n     */\n    validateImg: function () {\n      var _validateImg = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(imgInfo) {\n        var rules, rule, ratio;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                rules = this.rules;\n                /** @type ValidateRule */\n\n                // 针对动态规则模式, 获取输入为空时的规则\n                // 动态规则 rule 为函数, 当选择图片后根据选择的图片生成校验规则\n                if (typeof rules === 'function') {\n                  try {\n                    rule = rules(imgInfo);\n                  } catch (err) {\n                    rule = {};\n                  }\n                } else {\n                  rule = rules;\n                }\n\n                if (!(rule.allowAnimated && rule.allowAnimated > 0)) {\n                  _context3.next = 11;\n                  break;\n                }\n\n                if (!(imgInfo.isAnimated === null)) {\n                  _context3.next = 7;\n                  break;\n                }\n\n                this.$message.error('要进行是否动图验证需要配置 \"animated-check\" 属性为 true');\n                _context3.next = 11;\n                break;\n\n              case 7:\n                if (!(rule.allowAnimated === 1 && imgInfo.isAnimated)) {\n                  _context3.next = 9;\n                  break;\n                }\n\n                throw new Error(\"\\\"\".concat(imgInfo.name, \"\\\"\\u4E3A\\u52A8\\u6001\\u56FE, \\u4E0D\\u5141\\u8BB8\\u4E0A\\u4F20\"));\n\n              case 9:\n                if (!(rule.allowAnimated === 2 && !imgInfo.isAnimated)) {\n                  _context3.next = 11;\n                  break;\n                }\n\n                throw new Error(\"\\\"\".concat(imgInfo.name, \"\\\"\\u4E3A\\u9759\\u6001\\u56FE, \\u53EA\\u5141\\u8BB8\\u4E0A\\u4F20\\u52A8\\u6001\\u56FE\"));\n\n              case 11:\n                if (!rule.width) {\n                  _context3.next = 16;\n                  break;\n                }\n\n                if (!(imgInfo.width !== rule.width)) {\n                  _context3.next = 14;\n                  break;\n                }\n\n                throw new Error(\"\\\"\".concat(imgInfo.name, \"\\\"\\u56FE\\u50CF\\u5BBD\\u4E0D\\u7B26\\u5408\\u8981\\u6C42, \\u9700\\u4E3A\").concat(rule.width));\n\n              case 14:\n                _context3.next = 20;\n                break;\n\n              case 16:\n                if (!(rule.minWidth && imgInfo.width < rule.minWidth)) {\n                  _context3.next = 18;\n                  break;\n                }\n\n                throw new Error(\"\\\"\".concat(imgInfo.name, \"\\\"\\u56FE\\u50CF\\u5BBD\\u4E0D\\u7B26\\u5408\\u8981\\u6C42, \\u81F3\\u5C11\\u4E3A\").concat(rule.minWidth));\n\n              case 18:\n                if (!(rule.maxWidth && imgInfo.width > rule.maxWidth)) {\n                  _context3.next = 20;\n                  break;\n                }\n\n                throw new Error(\"\\\"\".concat(imgInfo.name, \"\\\"\\u56FE\\u50CF\\u5BBD\\u4E0D\\u7B26\\u5408\\u8981\\u6C42, \\u81F3\\u591A\\u4E3A\").concat(rule.maxWidth));\n\n              case 20:\n                if (!rule.height) {\n                  _context3.next = 25;\n                  break;\n                }\n\n                if (!(imgInfo.height !== rule.height)) {\n                  _context3.next = 23;\n                  break;\n                }\n\n                throw new Error(\"\\\"\".concat(imgInfo.name, \"\\\"\\u56FE\\u50CF\\u9AD8\\u4E0D\\u7B26\\u5408\\u8981\\u6C42, \\u9700\\u4E3A\").concat(rule.height));\n\n              case 23:\n                _context3.next = 29;\n                break;\n\n              case 25:\n                if (!(rule.minHeight && imgInfo.height < rule.minHeight)) {\n                  _context3.next = 27;\n                  break;\n                }\n\n                throw new Error(\"\\\"\".concat(imgInfo.name, \"\\\"\\u56FE\\u50CF\\u9AD8\\u4E0D\\u7B26\\u5408\\u8981\\u6C42, \\u81F3\\u5C11\\u4E3A\").concat(rule.minHeight));\n\n              case 27:\n                if (!(rule.maxHeight && imgInfo.height > rule.maxHeight)) {\n                  _context3.next = 29;\n                  break;\n                }\n\n                throw new Error(\"\\\"\".concat(imgInfo.name, \"\\\"\\u56FE\\u50CF\\u9AD8\\u4E0D\\u7B26\\u5408\\u8981\\u6C42, \\u81F3\\u591A\\u4E3A\").concat(rule.maxHeight));\n\n              case 29:\n                if (!rule.ratio) {\n                  _context3.next = 34;\n                  break;\n                }\n\n                if (Array.isArray(rule.ratio)) {\n                  ratio = rule.ratio[0] / rule.ratio[1];\n                } else {\n                  // eslint-disable-next-line\n                  ratio = rule.ratio;\n                }\n\n                ratio = ratio.toFixed(2);\n\n                if (!((imgInfo.width / imgInfo.height).toFixed(2) !== ratio)) {\n                  _context3.next = 34;\n                  break;\n                }\n\n                throw new Error(\"\\\"\".concat(imgInfo.name, \"\\\"\\u56FE\\u50CF\\u5BBD\\u9AD8\\u6BD4\\u4E0D\\u7B26\\u5408\\u8981\\u6C42, \\u9700\\u4E3A\").concat(ratio));\n\n              case 34:\n                if (!(rule.minSize && imgInfo.size < rule.minSize * ONE_MB)) {\n                  _context3.next = 36;\n                  break;\n                }\n\n                throw new Error(\"\\\"\".concat(imgInfo.name, \"\\\"\\u56FE\\u50CF\\u6587\\u4EF6\\u5927\\u5C0F\\u6BD4\\u4E0D\\u7B26\\u5408\\u8981\\u6C42, \\u81F3\\u5C11\\u4E3A\").concat(rule.minSize, \"Mb\"));\n\n              case 36:\n                if (!(rule.maxSize && imgInfo.size > rule.maxSize * ONE_MB)) {\n                  _context3.next = 38;\n                  break;\n                }\n\n                throw new Error(\"\\\"\".concat(imgInfo.name, \"\\\"\\u56FE\\u50CF\\u6587\\u4EF6\\u5927\\u5C0F\\u6BD4\\u4E0D\\u7B26\\u5408\\u8981\\u6C42, \\u81F3\\u591A\\u4E3A\").concat(rule.maxSize, \"Mb\"));\n\n              case 38:\n                return _context3.abrupt(\"return\", true);\n\n              case 39:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function validateImg(_x2) {\n        return _validateImg.apply(this, arguments);\n      }\n\n      return validateImg;\n    }(),\n\n    /**\r\n     * 选择图像文件后处理, 包括获取图像信息, 验证图像等\r\n     * @param {Event} e input change 事件对象\r\n     */\n    handleChange: function () {\n      var _handleChange = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5(e) {\n        var _this4 = this;\n\n        var currentId, autoUpload, files, imgInfoList, cache, handleImg, asyncList, i, _i2;\n\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                currentId = this.currentId, autoUpload = this.autoUpload;\n                files = e.target.files;\n\n                if (files) {\n                  _context5.next = 4;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\");\n\n              case 4:\n                /** 中间步骤缓存, 在出错时用于释放 createObjectURL 的内存 */\n                cache = [];\n                /**\r\n                 * 处理单个图片, 返回处理成功的图片数据\r\n                 * @param {File} file 图片文件\r\n                 */\n\n                handleImg =\n                /*#__PURE__*/\n                function () {\n                  var _ref = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee4(file) {\n                    var info;\n                    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            _context4.prev = 0;\n                            _context4.next = 3;\n                            return _this4.getImgInfo(file);\n\n                          case 3:\n                            info = _context4.sent;\n                            cache.push(info); // 验证图像信息\n\n                            _context4.next = 7;\n                            return _this4.validateImg(info);\n\n                          case 7:\n                            return _context4.abrupt(\"return\", info);\n\n                          case 10:\n                            _context4.prev = 10;\n                            _context4.t0 = _context4[\"catch\"](0);\n                            throw _context4.t0;\n\n                          case 13:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4, null, [[0, 10]]);\n                  }));\n\n                  return function handleImg(_x4) {\n                    return _ref.apply(this, arguments);\n                  };\n                }();\n\n                asyncList = [];\n\n                for (i = 0; i < files.length; i += 1) {\n                  asyncList.push(handleImg(files[i]));\n                }\n\n                _context5.prev = 8;\n                _context5.next = 11;\n                return Promise.all(asyncList);\n\n              case 11:\n                imgInfoList = _context5.sent;\n                // 设置图片信息\n                this.setImgInfo(imgInfoList, currentId); // 开启自动上传\n\n                if (autoUpload) {\n                  this.itemList.forEach(function (ele) {\n                    _this4.uploadImg(ele);\n                  });\n                }\n\n                _context5.next = 22;\n                break;\n\n              case 16:\n                _context5.prev = 16;\n                _context5.t0 = _context5[\"catch\"](8);\n\n                // 清空缓存\n                for (_i2 = 0; _i2 < cache.length; _i2 += 1) {\n                  window.URL.revokeObjectURL(cache[_i2].localSrc);\n                }\n\n                cache = null;\n                console.error(_context5.t0);\n                this.$message.error(_context5.t0.message);\n\n              case 22:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[8, 16]]);\n      }));\n\n      function handleChange(_x3) {\n        return _handleChange.apply(this, arguments);\n      }\n\n      return handleChange;\n    }(),\n\n    /**\r\n     * 根据信息列表设置图像信息\r\n     * 用户选择图片, 图片通过验证后可获取到图像信息数组\r\n     * 将这一组图像信息数据设置在 itemList 中\r\n     * @param {Array<LocalFileInfo>} imgInfoList 需要设置的图像数组\r\n     * @param {Number|String} id 操作项的 id\r\n     */\n    setImgInfo: function setImgInfo() {\n      var imgInfoList = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      var currentId = arguments.length > 1 ? arguments[1] : undefined;\n      var max = this.max,\n          itemList = this.itemList; // 找到特定图像位置\n\n      var index = this.itemList.findIndex(function (item) {\n        return item.id === currentId;\n      }); // 释放内存\n\n      window.URL.revokeObjectURL(this.itemList[index].display); // 替换图片\n\n      this.itemList[index] = createItem(imgInfoList[0], this.itemList[index]); // 如果需要设置的图像数量大于1, 需要执行追加图片逻辑\n\n      if (imgInfoList.length > 1) {\n        // 最大图片数量限制\n        var l = imgInfoList.length;\n\n        if (this.isStable) {\n          // 固定数量模式, 按次序插入空项\n          for (var i = 0, k = 1; i < max && k < l; i += 1) {\n            if (itemList[i].status === 'input') {\n              this.itemList[i] = createItem(imgInfoList[k]);\n              k += 1;\n            }\n          }\n        } else {\n          var empty = max - itemList.length;\n\n          if (max && l > empty) {\n            l = empty;\n          }\n\n          if (itemList[itemList.length - 1].status === 'input') {\n            this.itemList.pop();\n          }\n\n          for (var _i3 = 1; _i3 <= l; _i3 += 1) {\n            this.itemList.push(createItem(imgInfoList[_i3]));\n          }\n        }\n      } // 初始化图片\n\n\n      this.initItemList(this.itemList);\n    },\n\n    /**\r\n     * 支持键盘操作\r\n     * @param {Event} e 键盘事件对象\r\n     * @param {Number|String} id 操作项的 id\r\n     */\n    handleKeydown: function handleKeydown(e, id) {\n      if (e.target !== e.currentTarget) return;\n\n      if (e.keyCode === 13 || e.keyCode === 32) {\n        this.handleClick(id);\n      }\n    },\n\n    /**\r\n     * 处理点击事件, 并转移到文件上传元素\r\n     * 并记录当前操作元素 id\r\n     * @param {Number|String} id 操作项的 id\r\n     */\n    handleClick: function handleClick(id) {\n      if (!this.disabled) {\n        this.currentId = id || '';\n        this.$refs.input.value = null;\n        this.$refs.input.click();\n      }\n    },\n\n    /**\r\n     * 初始化 itemList\r\n     * @param {Array} val 初始化的数据数组\r\n     */\n    initItemList: function initItemList(val) {\n      var max = this.max,\n          isStable = this.isStable,\n          disabled = this.disabled;\n      var result = []; // 初始值不存在情况\n      // 包括初始值不合法\n\n      if (!val || !Array.isArray(val) || val.length === 0) {\n        // 固定数量图像上传, 直接初始化固定数量的上传控件\n        if (isStable) {\n          for (var i = 0; i < max; i += 1) {\n            result.push(createItem());\n          }\n\n          this.itemList = result;\n          return;\n        } // 如果不是固定上传数量, 则仅创建一个空项\n\n\n        result.push(createItem());\n        this.itemList = result;\n        return;\n      } // 存在初始值\n\n\n      for (var _i4 = 0; _i4 < val.length; _i4 += 1) {\n        result.push(createItem(val[_i4]));\n      } // 初始项小于最大数量限制, 并且处于可编辑状态, 并且最后一项不是input\n\n\n      if ((max === 0 || val.length < max) && !disabled && val[val.length - 1].status !== 'input') {\n        // 后面添加空项\n        result.push(createItem());\n      }\n\n      this.itemList = result;\n    },\n\n    /**\r\n     * 获取图像信息\r\n     * @param {File} file 文件对象\r\n     * @returns {LocalFileInfo} 信息对象\r\n     */\n    getImgInfo: function () {\n      var _getImgInfo = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee6(file) {\n        var animatedCheck, localSrc, fileType, isAnimated;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                animatedCheck = this.animatedCheck;\n                localSrc = window.URL.createObjectURL(file); // 严格检测文件类型\n\n                _context6.next = 4;\n                return getFileType(file);\n\n              case 4:\n                fileType = _context6.sent;\n                // 检测是否是动图\n                isAnimated = null;\n\n                if (!animatedCheck) {\n                  _context6.next = 10;\n                  break;\n                }\n\n                _context6.next = 9;\n                return checkIsAnimated({\n                  file: file,\n                  fileType: fileType,\n                  fileUrl: localSrc\n                });\n\n              case 9:\n                isAnimated = _context6.sent;\n\n              case 10:\n                return _context6.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  var image = new Image();\n                  image.src = localSrc;\n\n                  image.onload = function () {\n                    /**\r\n                     * @type {LocalFileInfo}\r\n                     */\n                    var localFileInfo = {\n                      localSrc: localSrc,\n                      file: file,\n                      width: image.width,\n                      height: image.height,\n                      name: file.name,\n                      size: file.size,\n                      type: fileType === 'unknow' ? file.type : fileType,\n                      lastModified: file.lastModified,\n                      isAnimated: isAnimated\n                    };\n                    resolve(localFileInfo);\n                    image = null;\n                  };\n\n                  image.onerror = function () {\n                    reject(new Error('图像加载失败'));\n                    image = null;\n                  };\n                }));\n\n              case 11:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function getImgInfo(_x5) {\n        return _getImgInfo.apply(this, arguments);\n      }\n\n      return getImgInfo;\n    }(),\n\n    /** 清空全部图片 */\n    clear: function clear() {\n      this.initItemList([]);\n      this.getValue();\n    },\n\n    /** 重置图片数据传入属性 */\n    reset: function reset() {\n      this.initItemList(this.value);\n    }\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<!--\r\n Component: UploadImgs\r\n Describe: 多图片上传组件, 附有预览, 排序, 验证等功能\r\n\r\ntodo: 使用中间件模式优化信息装载和验证功能\r\ntodo: 文件判断使用 serveWorker 优化性能\r\n-->\r\n\r\n<template>\r\n  <div class=\"upload-imgs-container\" v-loading=\"loading\">\r\n    <template v-for=\"(item, i) in itemList\">\r\n      <template v-if=\"item.display\">\r\n        <div class=\"thumb-item\" :key=\"item.id\" :style=\"boxStyle\" v-loading=\"item.loading\">\r\n          <el-image class=\"thumb-item-img\" :src=\"item.display\" :fit=\"fit\" style=\"width: 100%; height: 100%;\"></el-image>\r\n          <div class=\"info\">\r\n            <i\r\n              v-if=\"item.file\"\r\n              class=\"el-icon-upload wait-upload\"\r\n              @click.prevent.stop=\"delItem(item.id)\"\r\n              title=\"等待上传\"\r\n            ></i>\r\n          </div>\r\n          <div class=\"control\">\r\n            <i v-if=\"!disabled\" class=\"el-icon-close del\" @click.prevent.stop=\"delItem(item.id)\" title=\"删除\"></i>\r\n            <div v-if=\"!disabled\" class=\"preview\" title=\"更换图片\" @click.prevent.stop=\"handleClick(item.id)\">\r\n              <i class=\"el-icon-edit\"></i>\r\n            </div>\r\n            <div class=\"control-bottom\" v-if=\"sortable || preview\">\r\n              <i\r\n                v-if=\"sortable && !disabled\"\r\n                title=\"前移\"\r\n                class=\"control-bottom-btn el-icon-back\"\r\n                :class=\"{ disabled: i === 0 }\"\r\n                @click.stop=\"move(item.id, -1)\"\r\n              ></i>\r\n              <i\r\n                v-if=\"preview\"\r\n                class=\"control-bottom-btn el-icon-view\"\r\n                title=\"预览\"\r\n                style=\"cursor: pointer;\"\r\n                @click.stop=\"previewImg(item, i)\"\r\n              ></i>\r\n              <i\r\n                v-if=\"sortable && !disabled\"\r\n                title=\"后移\"\r\n                class=\"control-bottom-btn el-icon-right\"\r\n                :class=\"{ disabled: i === itemList.length - 1 }\"\r\n                @click.stop=\"move(item.id, 1)\"\r\n              ></i>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </template>\r\n      <template v-else>\r\n        <div\r\n          class=\"upload-item\"\r\n          :class=\"{ disabled: disabled }\"\r\n          :key=\"item.id\"\r\n          :style=\"boxStyle\"\r\n          @click=\"handleClick(item.id)\"\r\n          @keydown=\"handleKeydown($event, item.id)\"\r\n        >\r\n          <i class=\"el-icon-plus\" style=\"font-size: 3em;\"></i>\r\n          <div v-html=\"rulesTip.join('<br>')\" style=\"margin-top: 1em;\"></div>\r\n        </div>\r\n      </template>\r\n    </template>\r\n    <input\r\n      class=\"upload-imgs__input\"\r\n      type=\"file\"\r\n      ref=\"input\"\r\n      @change=\"handleChange\"\r\n      :multiple=\"multiple\"\r\n      :accept=\"accept\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getFileType, checkIsAnimated, isEmptyObj, createId } from './utils'\r\n\r\n/**\r\n * 本地图像通过验证后构造的信息对象\r\n * @typedef {Object<string, number, any>} LocalFileInfo\r\n * @property {string} localSrc 本地图像预览地址\r\n * @property {File} file 本地图像文件\r\n * @property {number} width 宽\r\n * @property {number} height 高\r\n * @property {string} name 文件名\r\n * @property {number} size 文件大小\r\n * @property {string} type 文件的媒体类型 (MIME)\r\n * @property {Date} lastModified 文件最后修改时间\r\n * @property {boolean} isAnimated 是否是动态图, 如果不进行检测则为 null\r\n */\r\n\r\n/**\r\n * 返回数据对象\r\n * 初始化的图片如果没有传入字段, 则值为空 null\r\n * @typedef {Object<string, number>} ReturnItem\r\n * @property {number|string} id 初始化数据的 id\r\n * @property {number|string} imgId 图像资源 id\r\n * @property {string} src 文件相对路径\r\n * @property {string} display 图像完整地址\r\n * @property {number} height 高\r\n * @property {number} width 宽\r\n * @property {string} fileName 文件名\r\n * @property {string} fileType 文件的媒体类型 (MIME), 针对部分文件类型做了检测\r\n * @property {boolean} isAnimated 是否是动态图, 如果不进行检测则为 null\r\n */\r\n\r\n/**\r\n * 返回数据对象\r\n * @typedef {Object} ValidateRule\r\n * @property {array|number} ratio 比例 [宽，高], 或者 宽/高 的数值\r\n * @property {number} width 宽度必需等于\r\n * @property {number} height 高度必需等于\r\n * @property {number} minWidth 最小宽\r\n * @property {number} minHeight 最小高\r\n * @property {number} minSize 最小 size（Mb)\r\n * @property {number} maxSize 最大 size（Mb)\r\n * @property {number} allowAnimated 是否允许上传动图, 0 不检测, 1 不允许动图, 2 只允许动图. 要检查此项, 需设置属性 animated-check 为 true\r\n */\r\n\r\nconst ONE_KB = 1024\r\nconst ONE_MB = ONE_KB * 1024\r\n\r\n/**\r\n * 创建项, 如不传入参数则创建空项\r\n * status 状态转换说明:\r\n *  - 如果不传入参数, 创建上传空项, status: input\r\n *  - 如果只传入 data, 不传入 oldData\r\n *    - data 是本地数据(数据中是否携带id), status: new\r\n *    - data 不是本地数据(来源可能是初始化或是其他), status 与原状态保持一致, 如果没有原状态就是 init\r\n *  - data 与 oldData 都传入\r\n *    - data 为本地数据, oldData 是 input/new, status: new\r\n *    - data 为本地数据, oldData 是 init/edit, status: edit\r\n *    - data 不是本地数据, status 与原状态保持一致, 如果没有原状态就是 init\r\n * @returns {Item}\r\n */\r\nfunction createItem(data = null, oldData = {}) {\r\n  let item = {\r\n    loading: false,\r\n    id: createId(),\r\n    status: 'input', // new/edit/del/init/input\r\n    src: '', // 图像相对地址\r\n    display: '', // 图像完整地址, 用于显示\r\n    imgId: '', // 图像资源 id\r\n  }\r\n  // 未传入data, 说明是单纯新建, 单纯新建的值是输入框状态\r\n  if (!data) {\r\n    return item\r\n  }\r\n  // 判断是否是本地图片\r\n  if (data.file && !data.id) {\r\n    if (!isEmptyObj(oldData)) {\r\n      // 如果旧数据状态是输入框, 则为新图片\r\n      if (oldData.status === 'input' || oldData.status === 'new') {\r\n        item.status = 'new'\r\n      }\r\n      // 如果旧数据状态是初始化 init, 则为修改\r\n      if (oldData.status === 'init' || oldData.status === 'edit') {\r\n        item.status = 'edit'\r\n      }\r\n    } else {\r\n      item.status = 'new'\r\n    }\r\n\r\n    // 本地数据初始化\r\n    item.id = oldData.id || item.id\r\n    item.src = ''\r\n    item.imgId = ''\r\n    item.display = data.localSrc || item.display\r\n    item = Object.assign({}, data, item)\r\n    return item\r\n  }\r\n\r\n  // 存在id, 说明是传入已存在数据\r\n  item.id = data.id\r\n  item.imgId = data.imgId || item.imgId\r\n  item.src = data.src || item.src\r\n  item.display = data.display || item.display\r\n  item.status = data.status || 'init'\r\n  item = Object.assign({}, data, item)\r\n  return item\r\n}\r\n\r\n/**\r\n * 获取范围类型限制的提示文本\r\n * @param {String} prx 提示前缀\r\n * @param {Number} min 范围下限\r\n * @param {Number} max 范围上限\r\n * @param {String} unit 单位\r\n */\r\nfunction getRangeTip(prx, min, max, unit = '') {\r\n  let str = prx\r\n  if (min && max) {\r\n    // 有范围限制\r\n    str += ` ${min}${unit}~${max}${unit}`\r\n  } else if (min) {\r\n    // 只有最小范围\r\n    str += ` ≥ ${min}${unit}`\r\n  } else if (max) {\r\n    // 只有最大范围\r\n    str += ` ≤ ${max}${unit}`\r\n  } else {\r\n    // 无限制\r\n    str += '无限制'\r\n  }\r\n  return str\r\n}\r\n\r\n/** for originUpload: 一次请求最多的文件数量 */\r\nconst uploadLimit = 10\r\n/** for originUpload: 文件对象缓存 */\r\nlet catchData = []\r\n/** for originUpload: 计时器缓存 */\r\nlet time\r\n\r\nexport default {\r\n  name: 'UploadImgs',\r\n  data() {\r\n    return {\r\n      itemList: [],\r\n      loading: false,\r\n      currentId: '', // 正在操作项的id\r\n      globalImgPriview: '$imagePreview', // 全局图片预览方法名\r\n    }\r\n  },\r\n  props: {\r\n    /** 每一项宽度 */\r\n    width: {\r\n      type: [Number, String],\r\n      default: 160,\r\n    },\r\n    /** 每一项高度 */\r\n    height: {\r\n      type: [Number, String],\r\n      default: 160,\r\n    },\r\n    /** 是否开启自动上传 */\r\n    autoUpload: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    /** 初始化数据 */\r\n    value: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    /** 接受的文件类型 */\r\n    accept: {\r\n      type: String,\r\n      default: 'image/*',\r\n    },\r\n    /** 最少图片数量 */\r\n    minNum: {\r\n      type: Number,\r\n      default: 0,\r\n    },\r\n    /** 最多图片数量, 0 表示无限制 */\r\n    maxNum: {\r\n      type: Number,\r\n      default: 0,\r\n    },\r\n    /** 是否可排序 */\r\n    sortable: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    /** 是否可预览 */\r\n    preview: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    /** 是否可以一次多选 */\r\n    multiple: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    /** 图像验证规则 */\r\n    rules: {\r\n      type: [Object, Function],\r\n      default: () => ({\r\n        maxSize: 2,\r\n      }),\r\n    },\r\n    /** 是否禁用, 禁用后只可展示 不可进行编辑操作, 包括: 新增, 修改, 删除, 改变顺序 */\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    /** 上传前插入方法, 属于高级用法 */\r\n    beforeUpload: {\r\n      type: Function,\r\n      default: null,\r\n    },\r\n    /** 重写上传方法, 如果重写则覆盖组件内上传方法 */\r\n    remoteFuc: {\r\n      type: Function,\r\n      default: null,\r\n    },\r\n    /** 图像显示模式 */\r\n    fit: {\r\n      type: String,\r\n      default: 'contain',\r\n    },\r\n    /** 检测是否是动图 */\r\n    animatedCheck: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n  computed: {\r\n    /** 每项容器样式 */\r\n    boxStyle() {\r\n      const { width, height, disabled } = this\r\n      const style = {}\r\n      if (typeof width === 'number') {\r\n        style.width = `${width}px`\r\n      } else if (typeof width === 'string') {\r\n        style.width = width\r\n      }\r\n      if (typeof height === 'number') {\r\n        style.height = `${height}px`\r\n      } else if (typeof height === 'string') {\r\n        style.height = height\r\n      }\r\n      if (disabled) {\r\n        style.cursor = 'not-allowed'\r\n      } else {\r\n        style.cursor = 'pointer'\r\n      }\r\n\r\n      /** 提示字体最大尺寸 */\r\n      let fontSize = 12\r\n      /** 每行提示预设 */\r\n      const maxText = 8\r\n      if (typeof width === 'number' && width / maxText < fontSize) {\r\n        fontSize = (width / maxText).toFixed(2)\r\n      }\r\n      style.fontSize = `${fontSize}px`\r\n      style.textAlign = 'center'\r\n      style.position = 'relative'\r\n      style.display = 'flex'\r\n      style.alignItems = 'center'\r\n      style.justifyContent = 'center'\r\n      style.overflow = 'hidden'\r\n      style.lineHeight = '1.3'\r\n      style.flexDirection = 'column'\r\n\r\n      return style\r\n    },\r\n    /**\r\n     * 上传图像数量下限\r\n     * @returns {Number}\r\n     */\r\n    min() {\r\n      const { minNum } = this\r\n      return minNum < 0 ? 0 : parseInt(minNum, 10)\r\n    },\r\n    /**\r\n     * 上传图像数量上限\r\n     * @returns {Number}\r\n     */\r\n    max() {\r\n      const { min, maxNum } = this\r\n      // 兼容用最大值小于最小值情况\r\n      return maxNum < min ? min : parseInt(maxNum, 10)\r\n    },\r\n    /**\r\n     * 是否是固定数量(最小等于最大)\r\n     * @returns {Boolean}\r\n     */\r\n    isStable() {\r\n      const { min, max } = this\r\n      return max !== 0 && min === max\r\n    },\r\n    /** 构造图像规范提示 */\r\n    rulesTip() {\r\n      const { rules } = this\r\n      const tips = []\r\n\r\n      /** 图像验证规则 */\r\n      let basicRule\r\n      // 针对动态规则模式, 获取输入为空时的规则\r\n      // 动态规则 rule 为函数, 当选择图片后根据选择的图片生成校验规则\r\n      if (typeof rules === 'function') {\r\n        try {\r\n          basicRule = rules()\r\n        } catch (err) {\r\n          basicRule = {}\r\n        }\r\n      } else {\r\n        basicRule = rules || {}\r\n      }\r\n\r\n      // 宽高限制提示语\r\n      if (basicRule.width && basicRule.height) {\r\n        // 固定宽高限制\r\n        tips.push(`宽高 ${basicRule.width}x${basicRule.height}`)\r\n      } else if (basicRule.width) {\r\n        // 固定宽限制\r\n        tips.push(`宽度 ${basicRule.width}`)\r\n        tips.push(`${getRangeTip('高度', basicRule.minHeight, basicRule.maxHeight)}`)\r\n      } else if (basicRule.height) {\r\n        // 固定高限制\r\n        tips.push(`高度 ${basicRule.height}`)\r\n        tips.push(`${getRangeTip('宽度', basicRule.minWidth, basicRule.maxWidth)}`)\r\n      } else {\r\n        // 宽高都不固定\r\n        tips.push(`${getRangeTip('宽度', basicRule.minWidth, basicRule.maxWidth)}`)\r\n        tips.push(`${getRangeTip('高度', basicRule.minHeight, basicRule.maxHeight)}`)\r\n      }\r\n\r\n      // 宽高比限制提示语\r\n      if (basicRule.ratio) {\r\n        if (Array.isArray(basicRule.ratio)) {\r\n          tips.push(`宽高比 ${basicRule.ratio.join(':')}`)\r\n        } else {\r\n          tips.push(`宽高比 ${basicRule.ratio}`)\r\n        }\r\n      }\r\n\r\n      // 文件大小\r\n      if (basicRule.minSize || basicRule.maxSize) {\r\n        tips.push(getRangeTip('文件大小', basicRule.minSize, basicRule.maxSize, 'Mb'))\r\n      }\r\n\r\n      // 是否动态图\r\n      if (basicRule.allowAnimated && basicRule.allowAnimated > 0) {\r\n        if (basicRule.allowAnimated === 1) {\r\n          tips.push('不允许上传动图')\r\n        } else if (basicRule.allowAnimated === 1) {\r\n          tips.push('只允许上传动图')\r\n        }\r\n      }\r\n\r\n      return tips\r\n    },\r\n  },\r\n  watch: {\r\n    /** 初始化值修改时重新初始化, 并且清空当前的编辑状态 */\r\n    value(val) {\r\n      // 初始化数据\r\n      this.initItemList(val)\r\n    },\r\n  },\r\n  mounted() {\r\n    this.initItemList(this.value)\r\n  },\r\n  methods: {\r\n    /**\r\n     * 上传缓存中的图片\r\n     * @param {Array} uploadList 需要上传的缓存集合, 集合中包含回调函数\r\n     */\r\n    uploadCatch(uploadList) {\r\n      const data = {}\r\n      uploadList.forEach((item, index) => {\r\n        data[`file_${index}`] = item.img.file\r\n      })\r\n      return this.$axios({\r\n        method: 'post',\r\n        url: '/cms/file',\r\n        data,\r\n      })\r\n        .then(res => {\r\n          if (!Array.isArray(res) || res.length === 0) {\r\n            throw new Error('图像上传失败')\r\n          }\r\n\r\n          const resObj = res.reduce((acc, item) => {\r\n            acc[item.key] = item\r\n            return acc\r\n          }, {})\r\n\r\n          uploadList.forEach((item, index) => {\r\n            const remoteData = resObj[`file_${index}`]\r\n            item.cb(remoteData)\r\n          })\r\n        })\r\n        .catch(err => {\r\n          uploadList.forEach(item => {\r\n            item.cb(false)\r\n          })\r\n          let msg = '图像上传失败, 请重试'\r\n          if (err.message) {\r\n            // eslint-disable-next-line\r\n            msg = err.message\r\n          }\r\n          console.error(err)\r\n          this.$message.error(msg)\r\n        })\r\n    },\r\n    /**\r\n     * 内置上传文件方法, 使用 debounce 优化提交效率\r\n     * 此处只能使用回调模式, 因为涉及 debounce 处理, promise 不可在外部改变其状态\r\n     * @param {Object} img 需要上传的数据项\r\n     * @param {Function} cb 回调函数\r\n     */\r\n    originUpload(img, cb) {\r\n      // 并且一次最多上传文件数量设为可配置\r\n      // 添加缓存\r\n      catchData.push({\r\n        img,\r\n        cb,\r\n      })\r\n\r\n      // 等于上限, 立即上传\r\n      if (catchData.length === uploadLimit) {\r\n        const data = [...catchData]\r\n        catchData = []\r\n        clearTimeout(time)\r\n        time = null\r\n        return this.uploadCatch(data)\r\n      }\r\n\r\n      // 清除上次一的定时器\r\n      if (time && catchData.length < uploadLimit) {\r\n        clearTimeout(time)\r\n        // 此时修改上一个 promise 状态为reslove\r\n      }\r\n\r\n      // 等待100ms\r\n      time = setTimeout(() => {\r\n        this.uploadCatch([...catchData])\r\n        catchData = []\r\n        time = null\r\n      }, 50)\r\n    },\r\n    /**\r\n     * 上传图像文件\r\n     * @param {Object} 需要上传的项, 包含文化和其它信息\r\n     */\r\n    async uploadImg(item) {\r\n      // 远程结果处理\r\n      const reduceResult = (imgItem, res) => {\r\n        // eslint-disable-next-line\r\n        imgItem.loading = false\r\n        if (!res) {\r\n          return\r\n        }\r\n        // eslint-disable-next-line\r\n        imgItem.display = res.url\r\n        // eslint-disable-next-line\r\n        imgItem.src = res.path\r\n        // eslint-disable-next-line\r\n        imgItem.imgId = res.id\r\n        // eslint-disable-next-line\r\n        imgItem.file = null\r\n        window.URL.revokeObjectURL(imgItem.display)\r\n      }\r\n\r\n      if (item.status === 'input' || !item.file) {\r\n        return\r\n      }\r\n      // eslint-disable-next-line\r\n      item.loading = true\r\n      if (this.beforeUpload && typeof this.beforeUpload === 'function') {\r\n        if (typeof this.beforeUpload === 'function') {\r\n          const result = await new Promise(resolve => {\r\n            let beforeUploadResult\r\n            try {\r\n              beforeUploadResult = this.beforeUpload(item, data => {\r\n                resolve(!!data)\r\n              })\r\n            } catch (err) {\r\n              resolve(false)\r\n            }\r\n            // promise 模式\r\n            if (beforeUploadResult != null && typeof beforeUploadResult.then === 'function') {\r\n              beforeUploadResult\r\n                .then(remoteData => {\r\n                  resolve(!!remoteData)\r\n                })\r\n                .catch(() => {\r\n                  resolve(false)\r\n                })\r\n            }\r\n          })\r\n          if (!result) {\r\n            reduceResult(item, false)\r\n            return false\r\n          }\r\n        }\r\n      }\r\n      // 如果是用户自定义方法\r\n      // 出于简化 api 的考虑, 只允许单个文件上传, 不进行代理\r\n      if (this.remoteFuc && typeof this.remoteFuc === 'function') {\r\n        const result = await new Promise(resolve => {\r\n          let remoteFucResult\r\n          try {\r\n            remoteFucResult = this.remoteFuc(item.file, remoteData => {\r\n              resolve(remoteData || false)\r\n            })\r\n          } catch (err) {\r\n            this.$message.error('执行自定义上传出错')\r\n            resolve(false)\r\n          }\r\n          // promise 模式\r\n          if (remoteFucResult != null && typeof remoteFucResult.then === 'function') {\r\n            remoteFucResult\r\n              .then(remoteData => {\r\n                resolve(remoteData || false)\r\n              })\r\n              .catch(() => {\r\n                resolve(false)\r\n              })\r\n          }\r\n        })\r\n        reduceResult(item, result)\r\n        if (!result) {\r\n          return false\r\n        }\r\n        return item\r\n      }\r\n\r\n      // 使用内置上传\r\n      return new Promise(resolve => {\r\n        this.originUpload(item, data => {\r\n          reduceResult(item, data)\r\n          if (!data) {\r\n            resolve(false)\r\n          } else {\r\n            resolve(item)\r\n          }\r\n        })\r\n      })\r\n    },\r\n    /**\r\n     * 获取当前组件数据\r\n     */\r\n    async getValue() {\r\n      const { itemList, isStable, min } = this\r\n\r\n      // 检查是否有不符合要求的空项\r\n      const l = isStable ? itemList.length : itemList.length - 1\r\n      for (let i = 0; i < l; i += 1) {\r\n        if (itemList[i].status === 'input') {\r\n          this.$message.error('当前存在未选择图片, 请全部选择')\r\n          return false\r\n        }\r\n      }\r\n      if (l < min) {\r\n        this.$message.error(`至少选择${min}张图片`)\r\n        return false\r\n      }\r\n      // 提取需要上传文件\r\n      const asyncList = []\r\n\r\n      for (let i = 0; i < itemList.length; i += 1) {\r\n        // 跳过上传组件\r\n        if (itemList[i].status !== 'input') {\r\n          if (!itemList[i].file) {\r\n            asyncList.push(Promise.resolve(itemList[i]))\r\n          } else {\r\n            // 上传文件后获取对应key值\r\n            asyncList.push(this.uploadImg(itemList[i]))\r\n          }\r\n        }\r\n      }\r\n      const imgInfoList = await Promise.all(asyncList)\r\n      // const imgInfoList = this.itemList.filter(item => (item.status !== 'input'))\r\n\r\n      // 检查是否有上传失败的图像\r\n      // 如果有失败的上传, 则返回错误\r\n      if (imgInfoList.some(item => !item)) {\r\n        return false\r\n      }\r\n\r\n      // 如无错误, 表示图像都以上传, 开始构造数据\r\n      /**\r\n       * @type {array<ReturnItem>}\r\n       */\r\n      const result = imgInfoList.map(item => {\r\n        /** @type {ReturnItem} */\r\n        const val = {\r\n          id: item.status === 'new' ? '' : item.id,\r\n          imgId: item.imgId || null,\r\n          src: item.src || null,\r\n          display: item.display,\r\n          width: item.width || null,\r\n          height: item.height || null,\r\n          fileSize: item.size || null,\r\n          fileName: item.name || null,\r\n          fileType: item.type || null,\r\n          isAnimated: item.isAnimated || null,\r\n        }\r\n        return val\r\n      })\r\n      // 获取数据成功后发出\r\n      this.$emit('upload', result)\r\n      return result\r\n    },\r\n    /**\r\n     * 删除某项\r\n     * @param {Number|String} id 删除项 id\r\n     */\r\n    delItem(id) {\r\n      const { itemList, isStable } = this\r\n      // 根据id找到对应项\r\n      const index = itemList.findIndex(item => item.id === id)\r\n      const blobUrl = itemList[index].display\r\n      if (isStable) {\r\n        // 固定数量图片, 删除后留下空项\r\n        itemList[index] = createItem()\r\n        this.itemList = [...itemList]\r\n      } else {\r\n        itemList.splice(index, 1)\r\n      }\r\n      // 释放内存\r\n      window.URL.revokeObjectURL(blobUrl)\r\n      this.initItemList(this.itemList)\r\n    },\r\n    /**\r\n     * 预览图像\r\n     * @param {Object} data 需要预览的项的数据\r\n     * @param {Number} index 索引序号\r\n     */\r\n    previewImg(data, index) {\r\n      // 如果有全局预览方法\r\n      if (this[this.globalImgPriview]) {\r\n        const images = []\r\n        this.itemList.forEach(element => {\r\n          if (element.display) {\r\n            images.push(element.display)\r\n          }\r\n        })\r\n        this[this.globalImgPriview]({\r\n          images,\r\n          index,\r\n        })\r\n      } else {\r\n        // element 原生粗糙模式\r\n        this.$confirm(`<img src=\"${data.display}\" style=\"width: 100%;\" />`, '预览', {\r\n          dangerouslyUseHTMLString: true,\r\n        })\r\n      }\r\n    },\r\n    /**\r\n     * 移动图像位置\r\n     * @param {Number|String} id 操作项的 id\r\n     * @param {Number} step 移动的偏移量\r\n     */\r\n    move(id, step) {\r\n      const { itemList, isStable } = this\r\n      // 找到操作的元素\r\n      const index = itemList.findIndex(item => item.id === id)\r\n      // 边界检测\r\n      if (index + step < 0 || index + step >= itemList.length) return\r\n      // 非固定项时, 不可和最后一项输入换位子\r\n      if (!isStable && index + step === itemList.length - 1) {\r\n        if (itemList[itemList.length - 1].status === 'input') return\r\n      }\r\n      const i = itemList[index]\r\n      const j = itemList[index + step]\r\n      itemList[index] = j\r\n      itemList[index + step] = i\r\n      this.itemList = [...itemList]\r\n    },\r\n    /**\r\n     * 验证上传的图像是否符合要求\r\n     * @param {LocalFileInfo} imgInfo 图像信息, 包括文件名, 宽高\r\n     */\r\n    async validateImg(imgInfo) {\r\n      const { rules } = this\r\n      /** @type ValidateRule */\r\n      let rule\r\n      // 针对动态规则模式, 获取输入为空时的规则\r\n      // 动态规则 rule 为函数, 当选择图片后根据选择的图片生成校验规则\r\n      if (typeof rules === 'function') {\r\n        try {\r\n          rule = rules(imgInfo)\r\n        } catch (err) {\r\n          rule = {}\r\n        }\r\n      } else {\r\n        rule = rules\r\n      }\r\n\r\n      if (rule.allowAnimated && rule.allowAnimated > 0) {\r\n        if (imgInfo.isAnimated === null) {\r\n          this.$message.error('要进行是否动图验证需要配置 \"animated-check\" 属性为 true')\r\n        } else {\r\n          if (rule.allowAnimated === 1 && imgInfo.isAnimated) {\r\n            throw new Error(`\"${imgInfo.name}\"为动态图, 不允许上传`)\r\n          }\r\n          if (rule.allowAnimated === 2 && !imgInfo.isAnimated) {\r\n            throw new Error(`\"${imgInfo.name}\"为静态图, 只允许上传动态图`)\r\n          }\r\n        }\r\n      }\r\n\r\n      // 宽高限制\r\n      if (rule.width) {\r\n        if (imgInfo.width !== rule.width) {\r\n          throw new Error(`\"${imgInfo.name}\"图像宽不符合要求, 需为${rule.width}`)\r\n        }\r\n      } else {\r\n        if (rule.minWidth && imgInfo.width < rule.minWidth) {\r\n          throw new Error(`\"${imgInfo.name}\"图像宽不符合要求, 至少为${rule.minWidth}`)\r\n        }\r\n        if (rule.maxWidth && imgInfo.width > rule.maxWidth) {\r\n          throw new Error(`\"${imgInfo.name}\"图像宽不符合要求, 至多为${rule.maxWidth}`)\r\n        }\r\n      }\r\n      if (rule.height) {\r\n        if (imgInfo.height !== rule.height) {\r\n          throw new Error(`\"${imgInfo.name}\"图像高不符合要求, 需为${rule.height}`)\r\n        }\r\n      } else {\r\n        if (rule.minHeight && imgInfo.height < rule.minHeight) {\r\n          throw new Error(`\"${imgInfo.name}\"图像高不符合要求, 至少为${rule.minHeight}`)\r\n        }\r\n        if (rule.maxHeight && imgInfo.height > rule.maxHeight) {\r\n          throw new Error(`\"${imgInfo.name}\"图像高不符合要求, 至多为${rule.maxHeight}`)\r\n        }\r\n      }\r\n\r\n      // 宽高比限制提示语\r\n      if (rule.ratio) {\r\n        let ratio\r\n        if (Array.isArray(rule.ratio)) {\r\n          ratio = rule.ratio[0] / rule.ratio[1]\r\n        } else {\r\n          // eslint-disable-next-line\r\n          ratio = rule.ratio\r\n        }\r\n        ratio = ratio.toFixed(2)\r\n        if ((imgInfo.width / imgInfo.height).toFixed(2) !== ratio) {\r\n          throw new Error(`\"${imgInfo.name}\"图像宽高比不符合要求, 需为${ratio}`)\r\n        }\r\n      }\r\n\r\n      // 文件大小\r\n      if (rule.minSize && imgInfo.size < rule.minSize * ONE_MB) {\r\n        throw new Error(`\"${imgInfo.name}\"图像文件大小比不符合要求, 至少为${rule.minSize}Mb`)\r\n      }\r\n      if (rule.maxSize && imgInfo.size > rule.maxSize * ONE_MB) {\r\n        throw new Error(`\"${imgInfo.name}\"图像文件大小比不符合要求, 至多为${rule.maxSize}Mb`)\r\n      }\r\n\r\n      return true\r\n    },\r\n    /**\r\n     * 选择图像文件后处理, 包括获取图像信息, 验证图像等\r\n     * @param {Event} e input change 事件对象\r\n     */\r\n    async handleChange(e) {\r\n      const { currentId, autoUpload } = this\r\n      const { files } = e.target\r\n      let imgInfoList\r\n\r\n      if (!files) return\r\n      /** 中间步骤缓存, 在出错时用于释放 createObjectURL 的内存 */\r\n      let cache = []\r\n      /**\r\n       * 处理单个图片, 返回处理成功的图片数据\r\n       * @param {File} file 图片文件\r\n       */\r\n      const handleImg = async file => {\r\n        try {\r\n          // 获取图像信息\r\n          const info = await this.getImgInfo(file)\r\n          cache.push(info)\r\n          // 验证图像信息\r\n          await this.validateImg(info)\r\n          return info\r\n        } catch (err) {\r\n          // 往外抛异常\r\n          throw err\r\n        }\r\n      }\r\n      const asyncList = []\r\n      for (let i = 0; i < files.length; i += 1) {\r\n        asyncList.push(handleImg(files[i]))\r\n      }\r\n      try {\r\n        imgInfoList = await Promise.all(asyncList)\r\n        // 设置图片信息\r\n        this.setImgInfo(imgInfoList, currentId)\r\n        // 开启自动上传\r\n        if (autoUpload) {\r\n          this.itemList.forEach(ele => {\r\n            this.uploadImg(ele)\r\n          })\r\n        }\r\n      } catch (err) {\r\n        // 清空缓存\r\n        for (let i = 0; i < cache.length; i += 1) {\r\n          window.URL.revokeObjectURL(cache[i].localSrc)\r\n        }\r\n        cache = null\r\n        console.error(err)\r\n        this.$message.error(err.message)\r\n      }\r\n    },\r\n    /**\r\n     * 根据信息列表设置图像信息\r\n     * 用户选择图片, 图片通过验证后可获取到图像信息数组\r\n     * 将这一组图像信息数据设置在 itemList 中\r\n     * @param {Array<LocalFileInfo>} imgInfoList 需要设置的图像数组\r\n     * @param {Number|String} id 操作项的 id\r\n     */\r\n    setImgInfo(imgInfoList = [], currentId) {\r\n      const { max, itemList } = this\r\n      // 找到特定图像位置\r\n      const index = this.itemList.findIndex(item => item.id === currentId)\r\n      // 释放内存\r\n      window.URL.revokeObjectURL(this.itemList[index].display)\r\n      // 替换图片\r\n      this.itemList[index] = createItem(imgInfoList[0], this.itemList[index])\r\n\r\n      // 如果需要设置的图像数量大于1, 需要执行追加图片逻辑\r\n      if (imgInfoList.length > 1) {\r\n        // 最大图片数量限制\r\n        let l = imgInfoList.length\r\n        if (this.isStable) {\r\n          // 固定数量模式, 按次序插入空项\r\n          for (let i = 0, k = 1; i < max && k < l; i += 1) {\r\n            if (itemList[i].status === 'input') {\r\n              this.itemList[i] = createItem(imgInfoList[k])\r\n              k += 1\r\n            }\r\n          }\r\n        } else {\r\n          const empty = max - itemList.length\r\n          if (max && l > empty) {\r\n            l = empty\r\n          }\r\n          if (itemList[itemList.length - 1].status === 'input') {\r\n            this.itemList.pop()\r\n          }\r\n          for (let i = 1; i <= l; i += 1) {\r\n            this.itemList.push(createItem(imgInfoList[i]))\r\n          }\r\n        }\r\n      }\r\n\r\n      // 初始化图片\r\n      this.initItemList(this.itemList)\r\n    },\r\n    /**\r\n     * 支持键盘操作\r\n     * @param {Event} e 键盘事件对象\r\n     * @param {Number|String} id 操作项的 id\r\n     */\r\n    handleKeydown(e, id) {\r\n      if (e.target !== e.currentTarget) return\r\n      if (e.keyCode === 13 || e.keyCode === 32) {\r\n        this.handleClick(id)\r\n      }\r\n    },\r\n    /**\r\n     * 处理点击事件, 并转移到文件上传元素\r\n     * 并记录当前操作元素 id\r\n     * @param {Number|String} id 操作项的 id\r\n     */\r\n    handleClick(id) {\r\n      if (!this.disabled) {\r\n        this.currentId = id || ''\r\n        this.$refs.input.value = null\r\n        this.$refs.input.click()\r\n      }\r\n    },\r\n    /**\r\n     * 初始化 itemList\r\n     * @param {Array} val 初始化的数据数组\r\n     */\r\n    initItemList(val) {\r\n      const { max, isStable, disabled } = this\r\n      const result = []\r\n\r\n      // 初始值不存在情况\r\n      // 包括初始值不合法\r\n      if (!val || !Array.isArray(val) || val.length === 0) {\r\n        // 固定数量图像上传, 直接初始化固定数量的上传控件\r\n        if (isStable) {\r\n          for (let i = 0; i < max; i += 1) {\r\n            result.push(createItem())\r\n          }\r\n          this.itemList = result\r\n          return\r\n        }\r\n        // 如果不是固定上传数量, 则仅创建一个空项\r\n        result.push(createItem())\r\n        this.itemList = result\r\n        return\r\n      }\r\n\r\n      // 存在初始值\r\n      for (let i = 0; i < val.length; i += 1) {\r\n        result.push(createItem(val[i]))\r\n      }\r\n      // 初始项小于最大数量限制, 并且处于可编辑状态, 并且最后一项不是input\r\n      if ((max === 0 || val.length < max) && !disabled && val[val.length - 1].status !== 'input') {\r\n        // 后面添加空项\r\n        result.push(createItem())\r\n      }\r\n      this.itemList = result\r\n    },\r\n    /**\r\n     * 获取图像信息\r\n     * @param {File} file 文件对象\r\n     * @returns {LocalFileInfo} 信息对象\r\n     */\r\n    async getImgInfo(file) {\r\n      const { animatedCheck } = this\r\n      const localSrc = window.URL.createObjectURL(file)\r\n      // 严格检测文件类型\r\n      const fileType = await getFileType(file)\r\n      // 检测是否是动图\r\n      let isAnimated = null\r\n      if (animatedCheck) {\r\n        isAnimated = await checkIsAnimated({ file, fileType, fileUrl: localSrc })\r\n      }\r\n      return new Promise((resolve, reject) => {\r\n        let image = new Image()\r\n        image.src = localSrc\r\n        image.onload = () => {\r\n          /**\r\n           * @type {LocalFileInfo}\r\n           */\r\n          const localFileInfo = {\r\n            localSrc,\r\n            file,\r\n            width: image.width,\r\n            height: image.height,\r\n            name: file.name,\r\n            size: file.size,\r\n            type: fileType === 'unknow' ? file.type : fileType,\r\n            lastModified: file.lastModified,\r\n            isAnimated,\r\n          }\r\n          resolve(localFileInfo)\r\n          image = null\r\n        }\r\n        image.onerror = () => {\r\n          reject(new Error('图像加载失败'))\r\n          image = null\r\n        }\r\n      })\r\n    },\r\n    /** 清空全部图片 */\r\n    clear() {\r\n      this.initItemList([])\r\n      this.getValue()\r\n    },\r\n    /** 重置图片数据传入属性 */\r\n    reset() {\r\n      this.initItemList(this.value)\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.upload-imgs-container {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n\r\n  &:focus {\r\n    outline: none;\r\n  }\r\n\r\n  .upload-item,\r\n  .thumb-item {\r\n    border: 1px dashed #d9d9d9;\r\n    border-radius: 3px;\r\n    transition: all 0.1s;\r\n    color: #666666;\r\n    margin-right: 1em;\r\n    margin-bottom: 1em;\r\n\r\n    &.disabled {\r\n      color: #ababab;\r\n    }\r\n\r\n    &:not(.disabled):hover {\r\n      border-color: #3963bc;\r\n      color: #3963bc;\r\n    }\r\n  }\r\n\r\n  .thumb-item {\r\n    .info {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      width: 100%;\r\n      height: 100%;\r\n      top: 0;\r\n      left: 0;\r\n      transition: all 0.3s;\r\n      transition-delay: 0.1s;\r\n\r\n      .wait-upload {\r\n        background: #ffcb71;\r\n        color: white;\r\n        position: absolute;\r\n        display: inline-block;\r\n        width: 1.7em;\r\n        height: 1.5em;\r\n        top: 0;\r\n        right: 0;\r\n        border-radius: 0 0 0 1.4em;\r\n        transition: all 0.1s;\r\n\r\n        &::before {\r\n          font-size: 1.4em;\r\n          position: absolute;\r\n          right: -1px;\r\n          transform: scale(0.7);\r\n        }\r\n      }\r\n    }\r\n\r\n    .control {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      width: 100%;\r\n      height: 100%;\r\n      top: 0;\r\n      left: 0;\r\n      opacity: 0;\r\n      background-color: rgba(0, 0, 0, 0.3);\r\n      transition: all 0.3s;\r\n      transition-delay: 0.1s;\r\n\r\n      .del {\r\n        background: #f4516c;\r\n        color: white;\r\n        position: absolute;\r\n        display: inline-block;\r\n        width: 1.7em;\r\n        height: 1.5em;\r\n        top: 0;\r\n        right: 0;\r\n        opacity: 0;\r\n        border-radius: 0 0 0 1.4em;\r\n        transition: all 0.1s;\r\n\r\n        &::before {\r\n          font-size: 1.4em;\r\n          position: absolute;\r\n          right: -1px;\r\n          transform: scale(0.7);\r\n        }\r\n\r\n        &:hover {\r\n          transform: translate(-0.5em, 0.4em) scale(1.5);\r\n        }\r\n      }\r\n\r\n      .preview {\r\n        color: white;\r\n        font-size: 2em;\r\n        transition: all 0.2s;\r\n\r\n        &:hover {\r\n          transform: scale(1.2);\r\n        }\r\n      }\r\n\r\n      .control-bottom {\r\n        position: absolute;\r\n        bottom: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        color: white;\r\n        background-color: rgba(0, 0, 0, 0.3);\r\n        font-size: 1.5em;\r\n        display: flex;\r\n        justify-content: space-around;\r\n        transform: translate(0, 100%);\r\n        transition: all 0.2s;\r\n        transition-delay: 0.1s;\r\n        padding: 5px 0;\r\n\r\n        .control-bottom-btn {\r\n          transform: all 0.2s;\r\n\r\n          &.disabled {\r\n            color: #ababab;\r\n            cursor: not-allowed;\r\n          }\r\n\r\n          &:not(.disabled):hover {\r\n            transform: scale(1.2);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    &:hover {\r\n      .control {\r\n        opacity: 1;\r\n      }\r\n\r\n      .del {\r\n        opacity: 1;\r\n      }\r\n\r\n      .control-bottom {\r\n        transform: translate(0, 0);\r\n      }\r\n    }\r\n  }\r\n\r\n  .upload-imgs__input {\r\n    display: none;\r\n  }\r\n}\r\n</style>\r\n"],"sourceRoot":"src/components/base/upload-imgs"}]}