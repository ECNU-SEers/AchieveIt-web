{"remainingRequest":"/Users/long/Documents/Software Development Practices/code/AchieveIt-web/node_modules/babel-loader/lib/index.js!/Users/long/Documents/Software Development Practices/code/AchieveIt-web/node_modules/eslint-loader/index.js??ref--13-0!/Users/long/Documents/Software Development Practices/code/AchieveIt-web/src/sys/plugins/axios.js","dependencies":[{"path":"/Users/long/Documents/Software Development Practices/code/AchieveIt-web/src/sys/plugins/axios.js","mtime":1582706417708},{"path":"/Users/long/Documents/Software Development Practices/code/AchieveIt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/long/Documents/Software Development Practices/code/AchieveIt-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/long/Documents/Software Development Practices/code/AchieveIt-web/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"/Users/long/Documents/Software Development Practices/code/AchieveIt-web/node_modules/@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n// ajax 封装插件, 使用 axios\nimport Vue from 'vue';\nimport axios from 'axios';\nimport Config from '@/config';\nimport ErrorCode from '@/config/error-code';\nimport store from '@/store';\nimport { getToken, saveAccessToken } from '@/sys/utils/token';\nvar config = {\n  baseURL: Config.baseURL || process.env.apiUrl || '',\n  timeout: 5 * 1000,\n  // 请求超时时间设置\n  crossDomain: true,\n  // withCredentials: true, // Check cross-site Access-Control\n  // 定义可获得的http响应状态码\n  // return true、设置为null或者undefined，promise将resolved,否则将rejected\n  validateStatus: function validateStatus(status) {\n    return status >= 200 && status < 510;\n  }\n}; // const retryTime = 2 // 请求失败重试次数\n// const retryDelay = 1500 // 请求失败重试间隔\n// 创建请求实例\n\nvar _axios = axios.create(config);\n\n_axios.interceptors.request.use(function (originConfig) {\n  // 有 API 请求重新计时\n  Vue.prototype.$_lin_jump();\n\n  var reqConfig = _objectSpread({}, originConfig); // step1: 容错处理\n\n\n  if (!reqConfig.url) {\n    /* eslint-disable-next-line */\n    console.error('request need url');\n    throw new Error({\n      source: 'axiosInterceptors',\n      message: 'request need url'\n    });\n  }\n\n  if (!reqConfig.method) {\n    // 默认使用 get 请求\n    reqConfig.method = 'get';\n  } // 大小写容错\n\n\n  reqConfig.method = reqConfig.method.toLowerCase(); // 参数容错\n\n  if (reqConfig.method === 'get') {\n    if (!reqConfig.params) {\n      // 防止字段用错\n      reqConfig.params = reqConfig.data || {};\n    }\n  } else if (reqConfig.method === 'post') {\n    if (!reqConfig.data) {\n      // 防止字段用错\n      reqConfig.data = reqConfig.params || {};\n    } // 检测是否包含文件类型, 若包含则进行 formData 封装\n\n\n    var hasFile = false;\n    Object.keys(reqConfig.data).forEach(function (key) {\n      if (_typeof(reqConfig.data[key]) === 'object') {\n        var item = reqConfig.data[key];\n\n        if (item instanceof FileList || item instanceof File || item instanceof Blob) {\n          hasFile = true;\n        }\n      }\n    }); // 检测到存在文件使用 FormData 提交数据\n\n    if (hasFile) {\n      var formData = new FormData();\n      Object.keys(reqConfig.data).forEach(function (key) {\n        formData.append(key, reqConfig.data[key]);\n      });\n      reqConfig.data = formData;\n    }\n  } else {\n    // TODO: 其他类型请求数据格式处理\n\n    /* eslint-disable-next-line */\n    console.warn(\"\\u5176\\u4ED6\\u8BF7\\u6C42\\u7C7B\\u578B: \".concat(reqConfig.method, \", \\u6682\\u65E0\\u81EA\\u52A8\\u5904\\u7406\"));\n  } // step2: permission 处理\n\n\n  if (reqConfig.url === 'cms/user/refresh') {\n    var refreshToken = getToken('refresh_token');\n\n    if (refreshToken) {\n      // eslint-disable-next-line no-param-reassign\n      reqConfig.headers.Authorization = refreshToken;\n    }\n  } else {\n    // 有access_token\n    var accessToken = getToken('access_token');\n\n    if (accessToken) {\n      // eslint-disable-next-line no-param-reassign\n      reqConfig.headers.Authorization = accessToken;\n    }\n  }\n\n  return reqConfig;\n}, function (error) {\n  Promise.reject(error);\n}); // Add a response interceptor\n\n\n_axios.interceptors.response.use(\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(res) {\n    var _res$data, code, message;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            console.log('res--------', res);\n            _res$data = res.data, code = _res$data.code, message = _res$data.message; // eslint-disable-line\n\n            if (!(res.status.toString().charAt(0) === '2')) {\n              _context2.next = 4;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", res.data);\n\n          case 4:\n            return _context2.abrupt(\"return\", new Promise(\n            /*#__PURE__*/\n            function () {\n              var _ref2 = _asyncToGenerator(\n              /*#__PURE__*/\n              _regeneratorRuntime.mark(function _callee(resolve, reject) {\n                var url, cache, refreshResult, result, errorArr;\n                return _regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        url = res.config.url; // refresh_token 异常，直接登出\n\n                        if (!(code === 10000 || code === 10100)) {\n                          _context.next = 4;\n                          break;\n                        }\n\n                        setTimeout(function () {\n                          store.dispatch('loginOut');\n                          var origin = window.location.origin;\n                          window.location.href = origin;\n                        }, 1500);\n                        return _context.abrupt(\"return\", resolve(null));\n\n                      case 4:\n                        if (!(code === 10040 || code === 10041 || code === 10050 || code === 10051)) {\n                          _context.next = 16;\n                          break;\n                        }\n\n                        cache = {};\n\n                        if (!(cache.url !== url)) {\n                          _context.next = 16;\n                          break;\n                        }\n\n                        cache.url = url;\n                        _context.next = 10;\n                        return _axios('cms/user/refresh');\n\n                      case 10:\n                        refreshResult = _context.sent;\n                        saveAccessToken(refreshResult.access_token); // 将上次失败请求重发\n\n                        _context.next = 14;\n                        return _axios(res.config);\n\n                      case 14:\n                        result = _context.sent;\n                        return _context.abrupt(\"return\", resolve(result));\n\n                      case 16:\n                        if (!res.config.handleError) {\n                          _context.next = 18;\n                          break;\n                        }\n\n                        return _context.abrupt(\"return\", reject(res));\n\n                      case 18:\n                        console.log('message', message); // 如果本次请求添加了 showBackend: true, 弹出后端返回错误信息\n\n                        if (Config.useFrontEndErrorMsg && !res.config.showBackend) {\n                          // 弹出前端自定义错误信息\n                          errorArr = Object.entries(ErrorCode).filter(function (v) {\n                            return v[0] === code.toString();\n                          }); // 匹配到前端自定义的错误码\n\n                          if (errorArr.length > 0 && errorArr[0][1] !== '') {\n                            message = errorArr[0][1]; // eslint-disable-line\n                          } else {\n                            message = ErrorCode['777'];\n                          }\n                        }\n\n                        Vue.prototype.$message({\n                          message: message,\n                          type: 'error'\n                        });\n                        reject();\n\n                      case 22:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              }));\n\n              return function (_x2, _x3) {\n                return _ref2.apply(this, arguments);\n              };\n            }()));\n\n          case 5:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}(), function (error) {\n  if (!error.response) {\n    Vue.prototype.$notify({\n      title: 'Network Error',\n      dangerouslyUseHTMLString: true,\n      message: '<strong class=\"my-notify\">请检查 API 是否异常</strong>'\n    });\n    console.log('error', error);\n  } // 判断请求超时\n\n\n  if (error.code === 'ECONNABORTED' && error.message.indexOf('timeout') !== -1) {\n    Vue.prototype.$message({\n      type: 'warning',\n      message: '请求超时'\n    });\n  }\n\n  return Promise.reject(error);\n}); // eslint-disable-next-line\n\n\nPlugin.install = function (Vue, options) {\n  // eslint-disable-next-line\n  Vue.axios = _axios;\n  window.axios = _axios;\n  Object.defineProperties(Vue.prototype, {\n    axios: {\n      get: function get() {\n        return _axios;\n      }\n    },\n    $axios: {\n      get: function get() {\n        return _axios;\n      }\n    }\n  });\n};\n\nif (!Vue.axios) {\n  Vue.use(Plugin);\n} // 导出常用函数\n\n/**\n * @param {string} url\n * @param {object} data\n * @param {object} params\n */\n\n\nexport function post(url) {\n  var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var params = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  return _axios({\n    method: 'post',\n    url: url,\n    data: data,\n    params: params\n  });\n}\n/**\n * @param {string} url\n * @param {object} params\n */\n\nexport function get(url) {\n  var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return _axios({\n    method: 'get',\n    url: url,\n    params: params\n  });\n}\n/**\n * @param {string} url\n * @param {object} data\n * @param {object} params\n */\n\nexport function put(url) {\n  var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var params = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  return _axios({\n    method: 'put',\n    url: url,\n    params: params,\n    data: data\n  });\n}\n/**\n * @param {string} url\n * @param {object} params\n */\n\nexport function _delete(url) {\n  var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return _axios({\n    method: 'delete',\n    url: url,\n    params: params\n  });\n}\nexport default _axios;",{"version":3,"sources":["/Users/long/Documents/Software Development Practices/code/AchieveIt-web/src/sys/plugins/axios.js"],"names":["Vue","axios","Config","ErrorCode","store","getToken","saveAccessToken","config","baseURL","process","env","apiUrl","timeout","crossDomain","validateStatus","status","_axios","create","interceptors","request","use","originConfig","prototype","$_lin_jump","reqConfig","url","console","error","Error","source","message","method","toLowerCase","params","data","hasFile","Object","keys","forEach","key","item","FileList","File","Blob","formData","FormData","append","warn","refreshToken","headers","Authorization","accessToken","Promise","reject","response","res","log","code","toString","charAt","resolve","setTimeout","dispatch","origin","window","location","href","cache","refreshResult","access_token","result","handleError","useFrontEndErrorMsg","showBackend","errorArr","entries","filter","v","length","$message","type","$notify","title","dangerouslyUseHTMLString","indexOf","Plugin","install","options","defineProperties","get","$axios","post","put","_delete"],"mappings":"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","sourcesContent":["// ajax 封装插件, 使用 axios\nimport Vue from 'vue'\nimport axios from 'axios'\nimport Config from '@/config'\nimport ErrorCode from '@/config/error-code'\nimport store from '@/store'\nimport { getToken, saveAccessToken } from '@/sys/utils/token'\n\nconst config = {\n  baseURL: Config.baseURL || process.env.apiUrl || '',\n  timeout: 5 * 1000, // 请求超时时间设置\n  crossDomain: true,\n  // withCredentials: true, // Check cross-site Access-Control\n  // 定义可获得的http响应状态码\n  // return true、设置为null或者undefined，promise将resolved,否则将rejected\n  validateStatus(status) {\n    return status >= 200 && status < 510\n  },\n}\n\n// const retryTime = 2 // 请求失败重试次数\n// const retryDelay = 1500 // 请求失败重试间隔\n\n// 创建请求实例\nconst _axios = axios.create(config)\n\n_axios.interceptors.request.use(\n  originConfig => {\n    // 有 API 请求重新计时\n    Vue.prototype.$_lin_jump()\n\n    const reqConfig = { ...originConfig }\n\n    // step1: 容错处理\n    if (!reqConfig.url) {\n      /* eslint-disable-next-line */\n      console.error('request need url')\n      throw new Error({\n        source: 'axiosInterceptors',\n        message: 'request need url',\n      })\n    }\n\n    if (!reqConfig.method) {\n      // 默认使用 get 请求\n      reqConfig.method = 'get'\n    }\n    // 大小写容错\n    reqConfig.method = reqConfig.method.toLowerCase()\n\n    // 参数容错\n    if (reqConfig.method === 'get') {\n      if (!reqConfig.params) {\n        // 防止字段用错\n        reqConfig.params = reqConfig.data || {}\n      }\n    } else if (reqConfig.method === 'post') {\n      if (!reqConfig.data) {\n        // 防止字段用错\n        reqConfig.data = reqConfig.params || {}\n      }\n\n      // 检测是否包含文件类型, 若包含则进行 formData 封装\n      let hasFile = false\n      Object.keys(reqConfig.data).forEach(key => {\n        if (typeof reqConfig.data[key] === 'object') {\n          const item = reqConfig.data[key]\n          if (item instanceof FileList || item instanceof File || item instanceof Blob) {\n            hasFile = true\n          }\n        }\n      })\n\n      // 检测到存在文件使用 FormData 提交数据\n      if (hasFile) {\n        const formData = new FormData()\n        Object.keys(reqConfig.data).forEach(key => {\n          formData.append(key, reqConfig.data[key])\n        })\n        reqConfig.data = formData\n      }\n    } else {\n      // TODO: 其他类型请求数据格式处理\n      /* eslint-disable-next-line */\n      console.warn(`其他请求类型: ${reqConfig.method}, 暂无自动处理`)\n    }\n    // step2: permission 处理\n    if (reqConfig.url === 'cms/user/refresh') {\n      const refreshToken = getToken('refresh_token')\n      if (refreshToken) {\n        // eslint-disable-next-line no-param-reassign\n        reqConfig.headers.Authorization = refreshToken\n      }\n    } else {\n      // 有access_token\n      const accessToken = getToken('access_token')\n      if (accessToken) {\n        // eslint-disable-next-line no-param-reassign\n        reqConfig.headers.Authorization = accessToken\n      }\n    }\n    return reqConfig\n  },\n  error => {\n    Promise.reject(error)\n  },\n)\n\n// Add a response interceptor\n_axios.interceptors.response.use(\n  async res => {\n    console.log('res--------', res)\n    let { code, message } = res.data // eslint-disable-line\n    if (res.status.toString().charAt(0) === '2') {\n      return res.data\n    }\n    return new Promise(async (resolve, reject) => {\n      const { url } = res.config\n\n      // refresh_token 异常，直接登出\n      if (code === 10000 || code === 10100) {\n        setTimeout(() => {\n          store.dispatch('loginOut')\n          const { origin } = window.location\n          window.location.href = origin\n        }, 1500)\n        return resolve(null)\n      }\n      // 令牌相关，刷新令牌\n      if (code === 10040 || code === 10041 || code === 10050 || code === 10051) {\n        const cache = {}\n        if (cache.url !== url) {\n          cache.url = url\n          const refreshResult = await _axios('cms/user/refresh')\n          saveAccessToken(refreshResult.access_token)\n          // 将上次失败请求重发\n          const result = await _axios(res.config)\n          return resolve(result)\n        }\n      }\n      // 如果本次请求添加了 handleError: true，用户自己try catch，框架不做处理\n      if (res.config.handleError) {\n        return reject(res)\n      }\n      console.log('message', message)\n      // 如果本次请求添加了 showBackend: true, 弹出后端返回错误信息\n      if (Config.useFrontEndErrorMsg && !res.config.showBackend) {\n        // 弹出前端自定义错误信息\n        const errorArr = Object.entries(ErrorCode).filter(v => v[0] === code.toString())\n        // 匹配到前端自定义的错误码\n        if (errorArr.length > 0 && errorArr[0][1] !== '') {\n          message = errorArr[0][1] // eslint-disable-line\n        } else {\n          message = ErrorCode['777']\n        }\n      }\n\n      Vue.prototype.$message({\n        message,\n        type: 'error',\n      })\n      reject()\n    })\n  },\n  error => {\n    if (!error.response) {\n      Vue.prototype.$notify({\n        title: 'Network Error',\n        dangerouslyUseHTMLString: true,\n        message: '<strong class=\"my-notify\">请检查 API 是否异常</strong>',\n      })\n      console.log('error', error)\n    }\n\n    // 判断请求超时\n    if (error.code === 'ECONNABORTED' && error.message.indexOf('timeout') !== -1) {\n      Vue.prototype.$message({\n        type: 'warning',\n        message: '请求超时',\n      })\n    }\n    return Promise.reject(error)\n  },\n)\n\n// eslint-disable-next-line\nPlugin.install = function(Vue, options) {\n  // eslint-disable-next-line\n  Vue.axios = _axios\n  window.axios = _axios\n  Object.defineProperties(Vue.prototype, {\n    axios: {\n      get() {\n        return _axios\n      },\n    },\n    $axios: {\n      get() {\n        return _axios\n      },\n    },\n  })\n}\n\nif (!Vue.axios) {\n  Vue.use(Plugin)\n}\n\n// 导出常用函数\n\n/**\n * @param {string} url\n * @param {object} data\n * @param {object} params\n */\nexport function post(url, data = {}, params = {}) {\n  return _axios({\n    method: 'post',\n    url,\n    data,\n    params,\n  })\n}\n\n/**\n * @param {string} url\n * @param {object} params\n */\nexport function get(url, params = {}) {\n  return _axios({\n    method: 'get',\n    url,\n    params,\n  })\n}\n\n/**\n * @param {string} url\n * @param {object} data\n * @param {object} params\n */\nexport function put(url, data = {}, params = {}) {\n  return _axios({\n    method: 'put',\n    url,\n    params,\n    data,\n  })\n}\n\n/**\n * @param {string} url\n * @param {object} params\n */\nexport function _delete(url, params = {}) {\n  return _axios({\n    method: 'delete',\n    url,\n    params,\n  })\n}\n\nexport default _axios\n"]}]}