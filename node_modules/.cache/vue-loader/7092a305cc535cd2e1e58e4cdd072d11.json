{"remainingRequest":"/Users/syj/Git-Portal/AchieveIt-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/syj/Git-Portal/AchieveIt-web/src/views/admin/role/RoleList.vue?vue&type=style&index=0&id=0e5e6863&lang=scss&scoped=true&","dependencies":[{"path":"/Users/syj/Git-Portal/AchieveIt-web/src/views/admin/role/RoleList.vue","mtime":1583737757310},{"path":"/Users/syj/Git-Portal/AchieveIt-web/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/syj/Git-Portal/AchieveIt-web/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/syj/Git-Portal/AchieveIt-web/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/syj/Git-Portal/AchieveIt-web/node_modules/sass-loader/lib/loader.js","mtime":1533139052000},{"path":"/Users/syj/Git-Portal/AchieveIt-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/syj/Git-Portal/AchieveIt-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.container {\n    padding: 0 30px;\n\n    .title {\n        height: 59px;\n        line-height: 59px;\n        color: $parent-title-color;\n        font-size: 16px;\n        font-weight: 500;\n    }\n}\n\n.groupListInfoDialog /deep/ .el-dialog__footer {\n    text-align: left;\n    padding-left: 30px;\n}\n\n.groupListInfoDialog /deep/ .el-dialog__header {\n    padding-left: 30px;\n}\n\n.groupListInfoDialog /deep/ .el-dialog__body {\n    padding: 30px;\n}\n",{"version":3,"sources":["RoleList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4QA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA","file":"RoleList.vue","sourceRoot":"src/views/admin/role","sourcesContent":["<template>\n    <div class=\"container\">\n        <div class=\"title\">角色列表信息</div>\n        <lin-table\n                :tableColumn=\"tableColumn\"\n                :tableData=\"tableData\"\n                :operate=\"operate\"\n                @handleEdit=\"handleEdit\"\n                @handleDelete=\"handleDelete\"\n                @row-click=\"rowClick\"\n                v-loading=\"loading\"\n        >\n        </lin-table>\n        <el-dialog\n                :append-to-body=\"true\"\n                :visible.sync=\"dialogFormVisible\"\n                :before-close=\"handleClose\"\n                class=\"groupListInfoDialog\"\n        >\n            <div style=\"margin-top:-25px;\">\n                <el-tabs v-model=\"activeTab\" @tab-click=\"handleClick\">\n                    <el-tab-pane label=\"修改信息\" name=\"修改信息\" style=\"margin-top:10px;\">\n                        <el-form\n                                status-icon\n                                v-if=\"dialogFormVisible\"\n                                ref=\"form\"\n                                label-width=\"120px\"\n                                :model=\"form\"\n                                label-position=\"labelPosition\"\n                                :rules=\"rules\"\n                                style=\"margin-left:-35px;margin-bottom:-35px;margin-top:15px;\"\n                        >\n                            <el-form-item label=\"角色名称\" prop=\"name\">\n                                <el-input size=\"medium\" clearable v-model=\"form.name\"></el-input>\n                            </el-form-item>\n                            <el-form-item label=\"角色描述\" prop=\"info\">\n                                <el-input size=\"medium\" clearable v-model=\"form.info\"></el-input>\n                            </el-form-item>\n                        </el-form>\n                    </el-tab-pane>\n                    <el-tab-pane label=\"配置权限\" name=\"配置权限\" style=\"margin-top:10px;\">\n                        <group-permissions\n                                v-if=\"dialogFormVisible\"\n                                :id=\"id\"\n                                ref=\"groupPermissions\"\n                                @updatePermissions=\"updatePermissions\"\n                                @getCacheAuthIds=\"getCacheAuthIds\"\n                                @updateAllPermissions=\"updateAllPermissions\"\n                                style=\"margin-right:-30px;margin-left:-25px;margin-bottom:-10px;\"\n                        >\n                        </group-permissions>\n                    </el-tab-pane>\n                </el-tabs>\n            </div>\n            <div slot=\"footer\" class=\"dialog-footer\" style=\"padding-left:5px;\">\n                <el-button type=\"primary\" @click=\"confirmEdit\">确 定</el-button>\n                <el-button @click=\"resetForm('form')\">重 置</el-button>\n            </div>\n        </el-dialog>\n    </div>\n</template>\n\n<script>\n  import Utils from '@/sys/utils/util';\n  import Admin from '@/sys/models/admin';\n  import LinTable from '@/components/base/table/lin-table';\n  import GroupPermissions from './RolePermissions';\n\n  export default {\n    components: {\n      LinTable,\n      GroupPermissions,\n    },\n    inject: ['eventBus'],\n    data() {\n      return {\n        id: 0, // 角色id\n        tableData: [], // 表格数据\n        tableColumn: [], // 表头数据\n        operate: [], // 表格按键操作区\n        dialogFormVisible: false, // 是否弹窗\n        labelPosition: 'right', // 设置label位置\n        form: {\n          // 表单信息\n          name: '',\n          info: '',\n        },\n        allPermissions: {}, // 所有角色权限\n        permissions: [], // 拥有的角色权限\n        cachePermissions: [], // 缓存第一次打开弹窗的数据\n        cacheForm: {\n          // 缓存第一次的表单信息\n          name: '',\n          info: '',\n        },\n        loading: false,\n        activeTab: '修改信息', // tab 标题\n        rules: {\n          // 表单验证规则\n          name: [{required: true, message: '请输入角色名称', trigger: 'blur'}],\n          info: [],\n        },\n      };\n    },\n    methods: {\n      // 获取所有角色并传给table渲染\n      async getAllGroups() {\n        try {\n          this.loading = true;\n          this.tableData = await Admin.getAllGroups();\n          this.loading = false;\n        } catch (e) {\n          this.loading = false;\n          console.log(e);\n        }\n      },\n      async confirmEdit() {\n        // 修改角色信息\n        if (this.activeTab === '修改信息') {\n          if (this.form.name === '') {\n            this.$message.warning('请将信息填写完整');\n            return;\n          }\n          if (this.cacheForm.name !== this.form.name || this.cacheForm.info !== this.form.info) {\n            // eslint-disable-line\n            const res = await Admin.updateOneGroup(this.form.name, this.form.info, this.id);\n            if (res.code < window.SUCCESS_CODE) {\n              this.$message.success(`${res.message}`);\n              this.getAllGroups();\n            }\n          }\n        } else {\n          let addRes = 0;\n          let delRes = 0;\n          // 判断是否更改了角色权限\n          if (this.permissions.sort().toString() !== this.cachePermissions.sort().toString()) {\n            const deletePermissions = this.cachePermissions\n            .concat(this.permissions)\n            .filter(v => !this.permissions.includes(v));\n            const addPermissions = this.cachePermissions\n            .concat(this.permissions)\n            .filter(v => !this.cachePermissions.includes(v));\n\n            console.log(deletePermissions);\n            console.log(addPermissions);\n\n            if (addPermissions.length > 0) {\n              addRes = await Admin.dispatchPermissions(this.id, addPermissions);\n            }\n            if (deletePermissions.length > 0) {\n              delRes = await Admin.removePermissions(this.id, deletePermissions);\n            }\n            if (addRes.code < window.SUCCESS_CODE || delRes.code < window.SUCCESS_CODE) {\n              this.$message.success('权限修改成功');\n            }\n          }\n        }\n        this.dialogFormVisible = false;\n      },\n      resetForm(formName) {\n        this.$refs[formName].resetFields();\n        this.$refs.groupPermissions.getGroupPermissions();\n      },\n      // 获取所拥有的权限并渲染  由子组件提供\n      handleEdit(val) {\n        let selectedData;\n        // 单击 编辑按键\n        if (val.index >= 0) {\n          selectedData = val.row;\n        } else {\n          // 单机 table row\n          selectedData = val;\n        }\n        this.id = selectedData.id;\n        this.form.name = selectedData.name;\n        this.form.info = selectedData.info;\n        this.cacheForm = {...this.form};\n        this.dialogFormVisible = true;\n      },\n      handleDelete(val) {\n        let res;\n        this.$confirm('此操作将永久删除该角色, 是否继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning',\n        }).then(async () => {\n          try {\n            this.loading = true;\n            res = await Admin.deleteOneGroup(val.row.id);\n          } catch (e) {\n            this.loading = false;\n            console.log(e);\n          }\n          if (res.code < window.SUCCESS_CODE) {\n            await this.getAllGroups();\n            this.$message({\n              type: 'success',\n              message: `${res.message}`,\n            });\n          } else {\n            this.loading = false;\n            this.$message({\n              type: 'error',\n              message: `${res.message}`,\n            });\n          }\n        });\n      },\n      // 双击 table row\n      rowClick(row) {\n        this.handleEdit(row);\n      },\n      // 弹窗打开时，判断某一分类权限是否全部选中\n      initModuleCheck(moduleName) {\n        const currentModuleChildrenArr = Object.keys(this.allPermissions[moduleName]);\n        const intersect = Utils.getIntersect(currentModuleChildrenArr, this.permissions);\n        if (intersect.length === currentModuleChildrenArr.length) {\n          this.permissions.push(moduleName);\n        }\n      },\n      // 弹窗打开时，记录缓存所拥有的全部权限\n      getCacheAuthIds(ids) {\n        this.cachePermissions = ids;\n      },\n      // 获取拥有的权限\n      updatePermissions(permissions) {\n        this.permissions = permissions;\n      },\n      // 权限id集合\n      getAllAuthIds(allAuthIds) {\n        this.allAuthIds = allAuthIds;\n      },\n      // 获取所有权限\n      updateAllPermissions(allPermissions) {\n        this.allPermissions = allPermissions;\n      },\n      // 弹框 右上角 X\n      handleClose(done) {\n        done();\n      },\n      // 切换tab栏\n      handleClick(tab) {\n        this.activeTab = tab.name;\n      },\n      // 监听角色添加是否成功\n      async addGroup(flag) {\n        if (flag === true) {\n          await this.getAllGroups();\n        }\n      },\n    },\n    async created() {\n      await this.getAllGroups();\n      this.tableColumn = [{prop: 'name', label: '名称'}, {prop: 'info', label: '信息'}]; // 设置表头信息\n      this.operate = [\n        {name: '编辑', func: 'handleEdit', type: 'primary'},\n        {name: '删除', func: 'handleDelete', type: 'danger'},\n      ];\n      // 监听角色是否成功\n      this.eventBus.$on('addGroup', this.addGroup);\n    },\n    beforeDestroy() {\n      this.eventBus.$off('addUser', this.addGroup);\n    },\n  };\n</script>\n\n<style lang=\"scss\" scoped>\n    .container {\n        padding: 0 30px;\n\n        .title {\n            height: 59px;\n            line-height: 59px;\n            color: $parent-title-color;\n            font-size: 16px;\n            font-weight: 500;\n        }\n    }\n\n    .groupListInfoDialog /deep/ .el-dialog__footer {\n        text-align: left;\n        padding-left: 30px;\n    }\n\n    .groupListInfoDialog /deep/ .el-dialog__header {\n        padding-left: 30px;\n    }\n\n    .groupListInfoDialog /deep/ .el-dialog__body {\n        padding: 30px;\n    }\n</style>\n"]}]}