{"remainingRequest":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DownLoad\\git\\achieve\\AchieveIt-web\\src\\components\\base\\preview\\preview.vue?vue&type=style&index=0&id=0b68bbd3&lang=scss&scoped=true&","dependencies":[{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\src\\components\\base\\preview\\preview.vue","mtime":1584099524193},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\sass-loader\\lib\\loader.js","mtime":1533139052000},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.my-gallery {\r\n  opacity: 0;\r\n  display: none;\r\n}\r\n",{"version":3,"sources":["preview.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4NA;AACA;AACA;AACA","file":"preview.vue","sourceRoot":"src/components/base/preview","sourcesContent":["<template>\r\n  <div v-if=\"data.length\">\r\n    <div ref=\"myGallery\" class=\"my-gallery\" :data-pswp-uid=\"radom\">\r\n      <div v-if=\"slides.length\">\r\n        <div :key=\"radom + '_' + index\" v-for=\"(l, index) in slides\"><img preview :src=\"l\" alt=\"\" /></div>\r\n      </div>\r\n    </div>\r\n    <div ref=\"pswpWrap\" class=\"pswp\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">\r\n      <div class=\"pswp__bg\"></div>\r\n      <div class=\"pswp__scroll-wrap\">\r\n        <div class=\"pswp__container\">\r\n          <div class=\"pswp__item\"></div>\r\n          <div class=\"pswp__item\"></div>\r\n          <div class=\"pswp__item\"></div>\r\n        </div>\r\n        <div class=\"pswp__ui pswp__ui--hidden\">\r\n          <div class=\"pswp__top-bar\">\r\n            <div class=\"pswp__counter\"></div>\r\n            <button class=\"pswp__button pswp__button--close\" title=\"Close (Esc)\"></button>\r\n            <button class=\"pswp__button pswp__button--share\" title=\"Share\"></button>\r\n            <button class=\"pswp__button pswp__button--fs\" title=\"Toggle fullscreen\"></button>\r\n            <button class=\"pswp__button pswp__button--zoom\" title=\"Zoom in/out\"></button>\r\n            <div class=\"pswp__preloader\">\r\n              <div class=\"pswp__preloader__icn\">\r\n                <div class=\"pswp__preloader__cut\"><div class=\"pswp__preloader__donut\"></div></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"pswp__share-modal pswp__share-modal--hidden pswp__single-tap\">\r\n            <div class=\"pswp__share-tooltip\"></div>\r\n          </div>\r\n          <button class=\"pswp__button pswp__button--arrow--left\" title=\"Previous (arrow left)\"></button>\r\n          <button class=\"pswp__button pswp__button--arrow--right\" title=\"Next (arrow right)\"></button>\r\n          <div class=\"pswp__caption\"><div class=\"pswp__caption__center\"></div></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// photoswipe接口文档 http://photoswipe.com/documentation/api.html\r\n\r\nimport { Loading } from 'element-ui'\r\nimport 'photoswipe/dist/photoswipe.css'\r\nimport 'photoswipe/dist/default-skin/default-skin.css'\r\nimport PhotoSwipe from 'photoswipe/dist/photoswipe'\r\nimport PhotoSwipeUIDefault from 'photoswipe/dist/photoswipe-ui-default'\r\n/** 生成随机字符串 */\r\nfunction createId() {\r\n  return Math.random()\r\n    .toString(36)\r\n    .substring(2)\r\n}\r\nexport default {\r\n  name: 'PreviewImage',\r\n  props: {\r\n    data: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    imageIndex: {\r\n      type: Number,\r\n      default: 0,\r\n    },\r\n    options: {\r\n      type: Object,\r\n      default: () => {},\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      radom: createId(),\r\n      slides: this.data || [],\r\n      gallery: null,\r\n    }\r\n  },\r\n  watch: {\r\n    data(newVal) {\r\n      if (Array.isArray(newVal)) {\r\n        this.slides = Object.assign([], newVal)\r\n        if (newVal.length > 0) {\r\n          this.$nextTick(() => {\r\n            this.initPhotoSwipe()\r\n          })\r\n        }\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    if (this.slides.length > 0) {\r\n      this.$nextTick(() => {\r\n        this.initPhotoSwipe()\r\n      })\r\n    }\r\n  },\r\n  methods: {\r\n    /* eslint-disable */\r\n    async initPhotoSwipe() {\r\n      const that = this\r\n      const defaultOptions = {\r\n        fullscreenEl: true,\r\n        shareEl: false,\r\n        arrowEl: true,\r\n        preloaderEl: true,\r\n        history: false,\r\n        loop: false,\r\n        bgOpacity: 0.85,\r\n        showHideOpacity: true,\r\n        errorMsg: '<div class=\"pswp__error-msg\">图片加载失败</div>',\r\n      }\r\n      let { options, imageIndex } = this\r\n      options = options || {}\r\n      options = Object.assign(defaultOptions, options, {\r\n        index: imageIndex,\r\n      })\r\n      const loadingInstance = Loading.service()\r\n      const galleryElement = this.$refs.myGallery\r\n      this.radom = createId()\r\n      let pswpElement = this.$refs.pswpWrap\r\n      const items = await this.transThumbnailElements()\r\n      let photoSwipeOptions = {\r\n        galleryUID: this.radom,\r\n        getThumbBoundsFn: function(index) {\r\n          let thumbnail = items[index].el\r\n          let pageYScroll = window.pageYOffset || document.documentElement.scrollTop\r\n          let rect = thumbnail.getBoundingClientRect()\r\n          return {\r\n            x: rect.left,\r\n            y: rect.top + pageYScroll,\r\n            w: rect.width,\r\n          }\r\n        },\r\n        ...options,\r\n      }\r\n      this.gallery = new PhotoSwipe(pswpElement, PhotoSwipeUIDefault, items, photoSwipeOptions)\r\n      this.gallery.init()\r\n      loadingInstance.close()\r\n      // Gallery starts closing\r\n      this.gallery.listen('close', () => {\r\n        if (this.gallery) {\r\n          this.gallery.close()\r\n          this.gallery = null\r\n          this.slides = []\r\n        }\r\n        that.$emit('close')\r\n      })\r\n    },\r\n    async getWH(elem) {\r\n      return new Promise((resolve, reject) => {\r\n        if (typeof elem.naturalWidth === 'undefined') {\r\n          // IE 6/7/8\r\n          let img = new window.Image()\r\n          img.src = elem.getAttribute('src')\r\n          img.onload = function() {\r\n            resolve({\r\n              w: this.width,\r\n              h: this.height,\r\n            })\r\n          }\r\n          img.onerror = function() {\r\n            reject({\r\n              w: 0,\r\n              h: 0,\r\n            })\r\n          }\r\n        } else {\r\n          if (elem.naturalWidth > 0) {\r\n            resolve({\r\n              w: elem.naturalWidth,\r\n              h: elem.naturalHeight,\r\n            })\r\n          } else {\r\n            elem.onload = function() {\r\n              resolve({\r\n                w: this.naturalWidth,\r\n                h: this.naturalHeight,\r\n              })\r\n            }\r\n          }\r\n        }\r\n      })\r\n    },\r\n    async transThumbnailElements() {\r\n      const galleryElement = this.$refs.myGallery\r\n      const items = []\r\n      const previewElements = galleryElement.querySelectorAll('img[preview]')\r\n\r\n      for (let i = 0, l = previewElements.length; i < l; i++) {\r\n        let elem = previewElements[i]\r\n        let rw = 0\r\n        let rh = 0\r\n        const wh = await this.getWH(elem)\r\n        rw = wh.w\r\n        rh = wh.h\r\n\r\n        items.push({\r\n          el: elem,\r\n          src: elem.getAttribute('src'),\r\n          w: rw,\r\n          h: rh,\r\n        })\r\n      }\r\n      return items\r\n    },\r\n    destroy() {\r\n      // 销毁\r\n      if (this.gallery) {\r\n        this.gallery.close()\r\n        this.gallery = null\r\n      }\r\n    },\r\n  },\r\n  beforeDestroy() {\r\n    this.destroy()\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.my-gallery {\r\n  opacity: 0;\r\n  display: none;\r\n}\r\n</style>\r\n"]}]}