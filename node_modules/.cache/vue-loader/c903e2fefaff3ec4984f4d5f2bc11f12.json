{"remainingRequest":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DownLoad\\git\\achieve\\AchieveIt-web\\src\\views\\admin\\role\\RoleList.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\src\\views\\admin\\role\\RoleList.vue","mtime":1584099524336},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DownLoad\\git\\achieve\\AchieveIt-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Utils from '@/sys/utils/util';\nimport Admin from '@/sys/models/admin';\nimport LinTable from '@/components/base/table/lin-table';\nimport GroupPermissions from './RolePermissions';\n\nexport default {\n  components: {\n    LinTable,\n    GroupPermissions,\n  },\n  inject: ['eventBus'],\n  data() {\n    return {\n      id: 0, // 角色id\n      tableData: [], // 表格数据\n      tableColumn: [], // 表头数据\n      operate: [], // 表格按键操作区\n      dialogFormVisible: false, // 是否弹窗\n      labelPosition: 'right', // 设置label位置\n      form: {\n        // 表单信息\n        name: '',\n        info: '',\n      },\n      allPermissions: {}, // 所有角色权限\n      permissions: [], // 拥有的角色权限\n      cachePermissions: [], // 缓存第一次打开弹窗的数据\n      cacheForm: {\n        // 缓存第一次的表单信息\n        name: '',\n        info: '',\n      },\n      loading: false,\n      activeTab: '修改信息', // tab 标题\n      rules: {\n        // 表单验证规则\n        name: [{required: true, message: '请输入角色名称', trigger: 'blur'}],\n        info: [],\n      },\n    };\n  },\n  methods: {\n    // 获取所有角色并传给table渲染\n    async getAllGroups() {\n      try {\n        this.loading = true;\n        this.tableData = await Admin.getAllGroups();\n        this.loading = false;\n      } catch (e) {\n        this.loading = false;\n        console.log(e);\n      }\n    },\n    async confirmEdit() {\n      // 修改角色信息\n      if (this.activeTab === '修改信息') {\n        if (this.form.name === '') {\n          this.$message.warning('请将信息填写完整');\n          return;\n        }\n        if (this.cacheForm.name !== this.form.name || this.cacheForm.info !== this.form.info) {\n          // eslint-disable-line\n          const res = await Admin.updateOneGroup(this.form.name, this.form.info, this.id);\n          if (res.code < window.SUCCESS_CODE) {\n            this.$message.success(`${res.message}`);\n            this.getAllGroups();\n          }\n        }\n      } else {\n        let addRes = 0;\n        let delRes = 0;\n        // 判断是否更改了角色权限\n        if (this.permissions.sort().toString() !== this.cachePermissions.sort().toString()) {\n          const deletePermissions = this.cachePermissions\n          .concat(this.permissions)\n          .filter(v => !this.permissions.includes(v));\n          const addPermissions = this.cachePermissions\n          .concat(this.permissions)\n          .filter(v => !this.cachePermissions.includes(v));\n\n          console.log(deletePermissions);\n          console.log(addPermissions);\n\n          if (addPermissions.length > 0) {\n            addRes = await Admin.dispatchPermissions(this.id, addPermissions);\n          }\n          if (deletePermissions.length > 0) {\n            delRes = await Admin.removePermissions(this.id, deletePermissions);\n          }\n          if (addRes.code < window.SUCCESS_CODE || delRes.code < window.SUCCESS_CODE) {\n            this.$message.success('权限修改成功');\n          }\n        }\n      }\n      this.dialogFormVisible = false;\n    },\n    resetForm(formName) {\n      this.$refs[formName].resetFields();\n      this.$refs.groupPermissions.getGroupPermissions();\n    },\n    // 获取所拥有的权限并渲染  由子组件提供\n    handleEdit(val) {\n      let selectedData;\n      // 单击 编辑按键\n      if (val.index >= 0) {\n        selectedData = val.row;\n      } else {\n        // 单机 table row\n        selectedData = val;\n      }\n      this.id = selectedData.id;\n      this.form.name = selectedData.name;\n      this.form.info = selectedData.info;\n      this.cacheForm = {...this.form};\n      this.dialogFormVisible = true;\n    },\n    handleDelete(val) {\n      let res;\n      this.$confirm('此操作将永久删除该角色, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning',\n      }).then(async () => {\n        try {\n          this.loading = true;\n          res = await Admin.deleteOneGroup(val.row.id);\n        } catch (e) {\n          this.loading = false;\n          console.log(e);\n        }\n        if (res.code < window.SUCCESS_CODE) {\n          await this.getAllGroups();\n          this.$message({\n            type: 'success',\n            message: `${res.message}`,\n          });\n        } else {\n          this.loading = false;\n          this.$message({\n            type: 'error',\n            message: `${res.message}`,\n          });\n        }\n      });\n    },\n    // 双击 table row\n    rowClick(row) {\n      this.handleEdit(row);\n    },\n    // 弹窗打开时，判断某一分类权限是否全部选中\n    initModuleCheck(moduleName) {\n      const currentModuleChildrenArr = Object.keys(this.allPermissions[moduleName]);\n      const intersect = Utils.getIntersect(currentModuleChildrenArr, this.permissions);\n      if (intersect.length === currentModuleChildrenArr.length) {\n        this.permissions.push(moduleName);\n      }\n    },\n    // 弹窗打开时，记录缓存所拥有的全部权限\n    getCacheAuthIds(ids) {\n      this.cachePermissions = ids;\n    },\n    // 获取拥有的权限\n    updatePermissions(permissions) {\n      this.permissions = permissions;\n    },\n    // 权限id集合\n    getAllAuthIds(allAuthIds) {\n      this.allAuthIds = allAuthIds;\n    },\n    // 获取所有权限\n    updateAllPermissions(allPermissions) {\n      this.allPermissions = allPermissions;\n    },\n    // 弹框 右上角 X\n    handleClose(done) {\n      done();\n    },\n    // 切换tab栏\n    handleClick(tab) {\n      this.activeTab = tab.name;\n    },\n    // 监听角色添加是否成功\n    async addGroup(flag) {\n      if (flag === true) {\n        await this.getAllGroups();\n      }\n    },\n  },\n  async created() {\n    await this.getAllGroups();\n    this.tableColumn = [{prop: 'name', label: '名称'}, {prop: 'info', label: '信息'}]; // 设置表头信息\n    this.operate = [\n      {name: '编辑', func: 'handleEdit', type: 'primary'},\n      {name: '删除', func: 'handleDelete', type: 'danger'},\n    ];\n    // 监听角色是否成功\n    this.eventBus.$on('addGroup', this.addGroup);\n  },\n  beforeDestroy() {\n    this.eventBus.$off('addUser', this.addGroup);\n  },\n};\n",{"version":3,"sources":["RoleList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+DA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"RoleList.vue","sourceRoot":"src/views/admin/role","sourcesContent":["<template>\r\n    <div class=\"container\">\r\n        <div class=\"title\">角色列表信息</div>\r\n        <lin-table\r\n                :tableColumn=\"tableColumn\"\r\n                :tableData=\"tableData\"\r\n                :operate=\"operate\"\r\n                @handleEdit=\"handleEdit\"\r\n                @handleDelete=\"handleDelete\"\r\n                @row-click=\"rowClick\"\r\n                v-loading=\"loading\"\r\n        >\r\n        </lin-table>\r\n        <el-dialog\r\n                :append-to-body=\"true\"\r\n                :visible.sync=\"dialogFormVisible\"\r\n                :before-close=\"handleClose\"\r\n                class=\"groupListInfoDialog\"\r\n        >\r\n            <div style=\"margin-top:-25px;\">\r\n                <el-tabs v-model=\"activeTab\" @tab-click=\"handleClick\">\r\n                    <el-tab-pane label=\"修改信息\" name=\"修改信息\" style=\"margin-top:10px;\">\r\n                        <el-form\r\n                                status-icon\r\n                                v-if=\"dialogFormVisible\"\r\n                                ref=\"form\"\r\n                                label-width=\"120px\"\r\n                                :model=\"form\"\r\n                                label-position=\"labelPosition\"\r\n                                :rules=\"rules\"\r\n                                style=\"margin-left:-35px;margin-bottom:-35px;margin-top:15px;\"\r\n                        >\r\n                            <el-form-item label=\"角色名称\" prop=\"name\">\r\n                                <el-input size=\"medium\" clearable v-model=\"form.name\"></el-input>\r\n                            </el-form-item>\r\n                            <el-form-item label=\"角色描述\" prop=\"info\">\r\n                                <el-input size=\"medium\" clearable v-model=\"form.info\"></el-input>\r\n                            </el-form-item>\r\n                        </el-form>\r\n                    </el-tab-pane>\r\n                    <el-tab-pane label=\"配置权限\" name=\"配置权限\" style=\"margin-top:10px;\">\r\n                        <group-permissions\r\n                                v-if=\"dialogFormVisible\"\r\n                                :id=\"id\"\r\n                                ref=\"groupPermissions\"\r\n                                @updatePermissions=\"updatePermissions\"\r\n                                @getCacheAuthIds=\"getCacheAuthIds\"\r\n                                @updateAllPermissions=\"updateAllPermissions\"\r\n                                style=\"margin-right:-30px;margin-left:-25px;margin-bottom:-10px;\"\r\n                        >\r\n                        </group-permissions>\r\n                    </el-tab-pane>\r\n                </el-tabs>\r\n            </div>\r\n            <div slot=\"footer\" class=\"dialog-footer\" style=\"padding-left:5px;\">\r\n                <el-button type=\"primary\" @click=\"confirmEdit\">确 定</el-button>\r\n                <el-button @click=\"resetForm('form')\">重 置</el-button>\r\n            </div>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n  import Utils from '@/sys/utils/util';\r\n  import Admin from '@/sys/models/admin';\r\n  import LinTable from '@/components/base/table/lin-table';\r\n  import GroupPermissions from './RolePermissions';\r\n\r\n  export default {\r\n    components: {\r\n      LinTable,\r\n      GroupPermissions,\r\n    },\r\n    inject: ['eventBus'],\r\n    data() {\r\n      return {\r\n        id: 0, // 角色id\r\n        tableData: [], // 表格数据\r\n        tableColumn: [], // 表头数据\r\n        operate: [], // 表格按键操作区\r\n        dialogFormVisible: false, // 是否弹窗\r\n        labelPosition: 'right', // 设置label位置\r\n        form: {\r\n          // 表单信息\r\n          name: '',\r\n          info: '',\r\n        },\r\n        allPermissions: {}, // 所有角色权限\r\n        permissions: [], // 拥有的角色权限\r\n        cachePermissions: [], // 缓存第一次打开弹窗的数据\r\n        cacheForm: {\r\n          // 缓存第一次的表单信息\r\n          name: '',\r\n          info: '',\r\n        },\r\n        loading: false,\r\n        activeTab: '修改信息', // tab 标题\r\n        rules: {\r\n          // 表单验证规则\r\n          name: [{required: true, message: '请输入角色名称', trigger: 'blur'}],\r\n          info: [],\r\n        },\r\n      };\r\n    },\r\n    methods: {\r\n      // 获取所有角色并传给table渲染\r\n      async getAllGroups() {\r\n        try {\r\n          this.loading = true;\r\n          this.tableData = await Admin.getAllGroups();\r\n          this.loading = false;\r\n        } catch (e) {\r\n          this.loading = false;\r\n          console.log(e);\r\n        }\r\n      },\r\n      async confirmEdit() {\r\n        // 修改角色信息\r\n        if (this.activeTab === '修改信息') {\r\n          if (this.form.name === '') {\r\n            this.$message.warning('请将信息填写完整');\r\n            return;\r\n          }\r\n          if (this.cacheForm.name !== this.form.name || this.cacheForm.info !== this.form.info) {\r\n            // eslint-disable-line\r\n            const res = await Admin.updateOneGroup(this.form.name, this.form.info, this.id);\r\n            if (res.code < window.SUCCESS_CODE) {\r\n              this.$message.success(`${res.message}`);\r\n              this.getAllGroups();\r\n            }\r\n          }\r\n        } else {\r\n          let addRes = 0;\r\n          let delRes = 0;\r\n          // 判断是否更改了角色权限\r\n          if (this.permissions.sort().toString() !== this.cachePermissions.sort().toString()) {\r\n            const deletePermissions = this.cachePermissions\r\n            .concat(this.permissions)\r\n            .filter(v => !this.permissions.includes(v));\r\n            const addPermissions = this.cachePermissions\r\n            .concat(this.permissions)\r\n            .filter(v => !this.cachePermissions.includes(v));\r\n\r\n            console.log(deletePermissions);\r\n            console.log(addPermissions);\r\n\r\n            if (addPermissions.length > 0) {\r\n              addRes = await Admin.dispatchPermissions(this.id, addPermissions);\r\n            }\r\n            if (deletePermissions.length > 0) {\r\n              delRes = await Admin.removePermissions(this.id, deletePermissions);\r\n            }\r\n            if (addRes.code < window.SUCCESS_CODE || delRes.code < window.SUCCESS_CODE) {\r\n              this.$message.success('权限修改成功');\r\n            }\r\n          }\r\n        }\r\n        this.dialogFormVisible = false;\r\n      },\r\n      resetForm(formName) {\r\n        this.$refs[formName].resetFields();\r\n        this.$refs.groupPermissions.getGroupPermissions();\r\n      },\r\n      // 获取所拥有的权限并渲染  由子组件提供\r\n      handleEdit(val) {\r\n        let selectedData;\r\n        // 单击 编辑按键\r\n        if (val.index >= 0) {\r\n          selectedData = val.row;\r\n        } else {\r\n          // 单机 table row\r\n          selectedData = val;\r\n        }\r\n        this.id = selectedData.id;\r\n        this.form.name = selectedData.name;\r\n        this.form.info = selectedData.info;\r\n        this.cacheForm = {...this.form};\r\n        this.dialogFormVisible = true;\r\n      },\r\n      handleDelete(val) {\r\n        let res;\r\n        this.$confirm('此操作将永久删除该角色, 是否继续?', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning',\r\n        }).then(async () => {\r\n          try {\r\n            this.loading = true;\r\n            res = await Admin.deleteOneGroup(val.row.id);\r\n          } catch (e) {\r\n            this.loading = false;\r\n            console.log(e);\r\n          }\r\n          if (res.code < window.SUCCESS_CODE) {\r\n            await this.getAllGroups();\r\n            this.$message({\r\n              type: 'success',\r\n              message: `${res.message}`,\r\n            });\r\n          } else {\r\n            this.loading = false;\r\n            this.$message({\r\n              type: 'error',\r\n              message: `${res.message}`,\r\n            });\r\n          }\r\n        });\r\n      },\r\n      // 双击 table row\r\n      rowClick(row) {\r\n        this.handleEdit(row);\r\n      },\r\n      // 弹窗打开时，判断某一分类权限是否全部选中\r\n      initModuleCheck(moduleName) {\r\n        const currentModuleChildrenArr = Object.keys(this.allPermissions[moduleName]);\r\n        const intersect = Utils.getIntersect(currentModuleChildrenArr, this.permissions);\r\n        if (intersect.length === currentModuleChildrenArr.length) {\r\n          this.permissions.push(moduleName);\r\n        }\r\n      },\r\n      // 弹窗打开时，记录缓存所拥有的全部权限\r\n      getCacheAuthIds(ids) {\r\n        this.cachePermissions = ids;\r\n      },\r\n      // 获取拥有的权限\r\n      updatePermissions(permissions) {\r\n        this.permissions = permissions;\r\n      },\r\n      // 权限id集合\r\n      getAllAuthIds(allAuthIds) {\r\n        this.allAuthIds = allAuthIds;\r\n      },\r\n      // 获取所有权限\r\n      updateAllPermissions(allPermissions) {\r\n        this.allPermissions = allPermissions;\r\n      },\r\n      // 弹框 右上角 X\r\n      handleClose(done) {\r\n        done();\r\n      },\r\n      // 切换tab栏\r\n      handleClick(tab) {\r\n        this.activeTab = tab.name;\r\n      },\r\n      // 监听角色添加是否成功\r\n      async addGroup(flag) {\r\n        if (flag === true) {\r\n          await this.getAllGroups();\r\n        }\r\n      },\r\n    },\r\n    async created() {\r\n      await this.getAllGroups();\r\n      this.tableColumn = [{prop: 'name', label: '名称'}, {prop: 'info', label: '信息'}]; // 设置表头信息\r\n      this.operate = [\r\n        {name: '编辑', func: 'handleEdit', type: 'primary'},\r\n        {name: '删除', func: 'handleDelete', type: 'danger'},\r\n      ];\r\n      // 监听角色是否成功\r\n      this.eventBus.$on('addGroup', this.addGroup);\r\n    },\r\n    beforeDestroy() {\r\n      this.eventBus.$off('addUser', this.addGroup);\r\n    },\r\n  };\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n    .container {\r\n        padding: 0 30px;\r\n\r\n        .title {\r\n            height: 59px;\r\n            line-height: 59px;\r\n            color: $parent-title-color;\r\n            font-size: 16px;\r\n            font-weight: 500;\r\n        }\r\n    }\r\n\r\n    .groupListInfoDialog /deep/ .el-dialog__footer {\r\n        text-align: left;\r\n        padding-left: 30px;\r\n    }\r\n\r\n    .groupListInfoDialog /deep/ .el-dialog__header {\r\n        padding-left: 30px;\r\n    }\r\n\r\n    .groupListInfoDialog /deep/ .el-dialog__body {\r\n        padding: 30px;\r\n    }\r\n</style>\r\n"]}]}